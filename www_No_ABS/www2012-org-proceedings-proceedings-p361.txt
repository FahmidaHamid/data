The sale of sponsored search advertising space is a primary source of income for Internet companies, and responsible for billions of dollars in annual advertising revenue [7].
The Generalized Second Price (GSP) auction is the premier method by which sponsored search advertising space is sold; it is currently employed by Google, Bing, and Yahoo.
However, use of the GSP auction is not universal: the classical VCG mechanism was adopted by Facebook for its AdAuc-tion system [12].
In fact, Google also considered switching its advertising platform to a VCG auction some years ago, but eventually decided against it [24].
This apparent tension underlines the importance of understanding how these mechanisms compare.
There are many factors in comparing possible mechanisms: The welfare of three distinct user groups (the experience of the searchers, the welfare of advertisers, and the revenue of the auction) are all important considerations, as well as the simplicity of the auction design.
In this paper, we take the point of view of the seller and compare the revenue properties of the GSP and VCG auctions.
Previous studies of the revenue of GSP have largely focused on outcomes of the full information game, restricted to the subclass of envy-free equilibria [7, 26, 9].
Here we consider revenue in equilibria of the Bayesian partial information version of the game, as well as equilibria of the full information game that are not envy-free, and are interested to show that GSP generates close to as much revenue as the classical optimal VCG auction.
This comparison is natural, as in the Bayesian model the VCG auction is revenue optimal with the appropriate reserve price [21].
Let us  rst brie y describe the model introduced by Edel-man et al [7] and Varian [25].
In sponsored search, a user makes a query for certain keywords in a search engine and is presented with a list of relevant advertisements in addition to organic search results.
We assume a  pay-per-click  pricing model, in which the advertiser pays a fee to the search provider whenever a user clicks on an advertisement.
There are multiple positions (or  slots ) in which an ad may appear, and the probability that a user clicks an ad depends on its slot.
This is modeled as a click-through rate (CTR), a probability   associated with each slot, the probability of getting a click for an advertisement in that position.
The search engine must therefore determine which ads to place where, and determine a price per click for each slot.
This is done via an auction in which advertisers make bids, which are viewed as the advertiser s maximum willingness to pay per click.
We note that this simpli ed model as a one-shot case when budgets are large.
Also, for simplicity of presentation, we will assume that all ads have the same quality (i.e. click-through rate does not depend on the advertiser selected for a slot), though our results for the full information game extend to the version of the model with separable click-though rates.
The VCG and GSP mechanisms di er in the way in which the aforementioned auction is resolved.
In both auctions, advertisers are assigned slots in order of their bids, with higher bidders receiving slots with higher click probabilities.
The two auctions di er in their payment schemes.
In VCG, each agent pays an amount equal to his externality on the other agents: the decrease in the total welfare of all other agents caused by the presence of this advertiser.
By contrast, in GSP each advertiser simply pays a price per click equal to the next highest bid.
The VCG auction has the strong property of being truthful in dominant strategies.
The GSP auction is not truthful, and is therefore prone to strategic bidding behavior.
Indeed, strategic manipulation of bids is well-documented in historical GSP bidding data [6].
Since the VCG mechanism is truthful, the revenue of VCG is simply the revenue generated when all bidders declare their values truthfully.
If bidders declare their values truthfully in a GSP auction, GSP generates strictly more revenue than VCG.
However, rational agents may not declare their values truthfully when participating in a GSP auction.
Thus, when studying the revenue of GSP, we consider the revenue generated at a Nash equilibrium; that is, a pro le of bidding strategies such that no advertiser can improve his utility (or expected utility in the Bayesian case) by unilaterally deviating.
Our goal, then, is a comparison between the revenue of the VCG auction and the revenue of GSP at equilibrium.
Results.
In Section 3 we consider the Bayesian version of this game when valuations are drawn from identical and independent distributions that satisfy the regularity condition.
We show that if we allow the auctioneer to include reserve prices the GSP auction always obtains a constant fraction (1/6th) of the optimal VCG revenue, in expectation.
The Bayesian setting is motivated by player uncertainty: for many keywords, the ability of a player to exactly predict his opponents types is impaired.
Due to complicating factors such as the budgets, quality scores (which depend on many characteristics of each query, such as origin, time, and search history of the user), and the underlying ad allocation algorithm, each auction is di erent (even those triggered by the same search term) [23].
The resulting uncertainty is captured by equilib-ria in a Bayesian partial information model, where bidders can only evaluate the expected welfare of the equilibrium, with expectation taken over the valuations of other bidders.
It is well-known that, in this setting the revenue-optimal truthful mechanism is the VCG auction with Myerson s reserve price [21].
One might also wish to bound the revenue of GSP with respect to the revenue of VCG without reserve prices, but we show that this is not possible: there are cases in which the VCG revenue is unboundedly greater than the GSP revenue.
However, if the slot CTRs satisfy a certain well-separatedness condition - namely that the click through rates of adjacent slots di er by at least a certain constant factor then we prove that GSP always obtains a constant fraction of the VCG revenue even in settings of partial information, extending a result of Lahaie [15] who considered welfare under this assumption on the CTRs.
Our result holds even if we do not assume that agents avoid dominated strategies, as long as there are at least three participants in the auction.
In Sections 4 and 5 we consider the full information game.
When auctions with the same participants, valuations, and quality scores are repeated many times each day, a stable outcome can be modeled by a full-information Nash equilibrium of the one-shot game.
We prove that at any Nash equilibrium, the revenue generated by GSP is at least half of the VCG revenue, excluding the single largest payment of a bidder.
Thus, as long as the VCG revenue is not concentrated on the payment of a single participant, the worst-case GSP revenue approximates the VCG revenue to within a constant factor.
This result also holds with an arbitrary reserve price.
We also provide an example illustrating that the factor of 2 in our analysis is tight, and the revenue of GSP at equilibrium may be arbitrarily less than the full revenue of VCG (without excluding a bidder).
In Section 5 we analyze the tradeo s of the maximum revenue attainable by the full information GSP mechanism under di erent equilibrium notions.
We demonstrate that there can exist ine cient, non-envy-free equilibria that obtain greater revenue than any envy-free equilibrium.
However, we prove that if CTRs are convex, meaning that the marginal increase in CTR is monotone in slot position, then the optimal revenue always occurs at an envy-free equilibrium.
This implies that when click-through rates are convex, the GSP auction optimizes revenue at an equilibrium that simultaneously maximizes the social welfare.
The convexity assumption we introduce is quite natural and may be of independent interest.
Note that this assumption is satis ed in the case when CTRs degrade by a constant factor from one slot to the next.
Related Work.
There has been considerable amount of work on the economic and algorithmic issues behind sponsored search auctions   see the survey of Lahaie et al [16] for an overview of the early work and the survey of Maille et al [19] for recent developments.
The GSP model we adopt is due to Edelman et al [7], Varian [25] and Aggarwal et al [2].
Much of the previous work on the GSP auction considered social welfare properties of equilibria.
Edelman et al [7] and Var-ian [25] de ne a subclass of Nash equilibria called envy-free equilibria and show that such equilibria always exist and are socially optimal, therefore showing that the price of stability is 1 for the full information game.
Paes Leme and Tardos [22] showed a bound of 1.618 on the price of anarchy, which was recently improved to 1.282 by Caragiannis at al [4].
The Bayesian version of this game, when valuations are random and only the distribution is public knowledge, was  rst studied by Gomes and Sweeney [10] who showed that e cient equilibria may not exist in this setting.
Paes Leme and Tardos [22] prove a price of anarchy of 8, which was recently improved by Lucier and Paes Leme [18] and Caragiannis at al [4] to 3.03.
Considering revenue properties of GSP, Edelman et al [7], and Varian [25] show that envy free equilibria have revenue at least as good as the revenue of VCG.
Both [7] and [25] tion for this class of equilibria, but there is no strong theoretical model that explains this selection [3, 9].
Further, the notion of envy-free equilibria applies only in the full information game.
Varian [26] shows how to compute the revenue optimal envy-free Nash equilibrium, although his model allows agents to overbid (which is dominated strategy, and we consider it unnatural).
We consider the question of maximum revenue equilibria without the assumption of envy-free outcomes, and show that in general ine cient equilibria can generate more revenue than e cient ones, but this is no longer the case under a natural convexity assumption.
Gomes and Sweeney [10] study GSP as a Bayesian game, and show that symmetric e cient equilibria may not exist in the Bayesian setting.
They analyze the in uence of click-through-rates on the revenue in equilibrium and observe the counter-intuitive phenomenon by which revenue decreases when click-through-rates increase.
A common tool for increasing revenue in settings of partial information is to apply reserve prices, where bids are rejected unless they meet some minimum bid r. When bidders  values are drawn from identically distributed satisfying the regularity condition1, the revenue-optimal truthful auction for sponsored search is the VCG auction with an appropriate reserve price [21].
Edelman and Schwarz [8] show that in GSP auctions reserve prices have a surprisingly large e ect on revenue.
Edelman and Schwarz [9] model the repeated auctions for a keyword as a repeated game, and show, using Myerson s optimal auction [21], that if valuations are drawn from an iid distribution then the Nash equilibria that arise as a stable limit of rational play in this repeated game cannot have revenue more than the optimal auction: VCG with an appropriately chosen reserve price.
However, they don t consider whether GSP may generate revenue much less than the VCG auction, which is the main question we consider.
Also, unlike Edelman and Schwarz [9], we do not use the repeated nature of this game for arguing for certain equilibrium selection: rather, we consider all stable outcomes of the auction, not only those that arise as limits of rational repeated play.
Finally, we mention that the well-known revenue equivalence theorem, which provides conditions under which alternative mechanisms generate the same revenue at equilibrium, does not apply in our settings.
Revenue equivalence requires that agents have values drawn from identical distributions and that the mechanisms generate the same outcome.
As a result, this equivalence does not apply in the full information setting, and cannot be used to compare in-e cient equilibria of GSP to the VCG revenue.
An AdAuctions instance is composed of n players and n slots.
In the full information model, each player has a value vi for each click he gets, and each slot j has click-through-rate  j .
That means that if player i is allocated in slot j, he gets  j clicks in expectation, where  1   .
.
.
   n.
In the full information setting, we will assume players are numbered such that v1   v2   .
.
.
  vn.
Let   = ( 1, .
.
.
,  n) be the CTR vector and v = (v1, .
.
.
, vn) be the type vector.
form, normal, and exponential distributions.
The social welfare generated by the mechanism is given by A mechanism for the AdAuctions problem is as follows: it begins by eliciting bids bi from the players, which can be thought of as declared valuations.
We write b = (b1, .
.
.
, bn) for the bid vector.
Using the b and  , the mechanism chooses an allocation   : [n]   [n] which means that player  (j) is allocated to slot j, and a price vector p = (p1, .
.
.
, pn), where pi is the price that player i pays per click.
Player i then experiences utility ui(b) =  (i)(vi   pi), where  (i) =  1(i).
(cid:2) (cid:2) i  iv (i) and the revenue is given by R(b) = i  (i)pi.
We focus on two mechanisms: GSP and VCG.
In both mechanisms, the players are ordered by their bids, i.e,  (j) is the player with the jth largest bid, but they di er in the payments charged.
GSP mimics the single-item second price auction by charging each player the bid of the next highest bidder, i.e. pi = b ( (i)+1) if  (i) < n and zero otherwise.
VCG charges each player the exter-nality it imposes on the other players, which is pV CG =  (i) (cid:2)n j= (i)+1( j 1    j )b (j).
SW (v,  ) =
 i VCG is a truthful mechanism: regardless of what the other players are doing, it is a weakly dominant strategy for player i to report his true valuation.
The resulting outcome of VCG is therefore social-welfare optimal and the revenue is
 (i  1)( i 1    i)vi.
( j 1    j )vj = (cid:3) (cid:3) n(cid:3) (v) = i j>i i=2 The GSP auction, however, is not truthful.
Thus, for GSP, we are interested in the set of bid pro les that constitute a Nash equilibrium, i.e. such that ui(bi, b i)   ui(b(cid:2) i, b i), b(cid:2) i   [0, vi].
We will assume that players do not overbid (i.e. that bi   vi) since bidding more than one s true value is a weakly dominated strategy [22].
We say that an equilibrium is e cient if it maximizes social welfare, i.e.  (i) = i,  i in the full information version.
We will also consider the comparison between VCG and GSP in the presence of a reserve price.
Let VCGr be the VCG mechanism with reserve price r, where we discard all players with bids smaller then r and run the VCG mechanism on the remaining players, who then pay price per click max{pi, r}.
In the analogous variant of the GSP mechanism, which we call GSP with reserve price r (GSPr), we also discard all players with bids smaller then r, the remaining players are allocated using GSP, and the last player to be allocated pays price r per click.
Below, we represent the special classes of equilibria that have been studied in the literature, which we call equilibrium hierarchy for GSP.
We de ne and discuss them in Section 5 : (cid:2) (cid:3) (cid:2)  
 outcome envy-free equilibria (cid:3) (cid:2)   (cid:3) (cid:2) (cid:3) e cient Nash eq   all Nash
 In a Bayesian setting, each player knows her own valuation but only knows a distribution on the other players  valuations.
In this model the values of the players are random variables, with type vector v drawn from a known distribution F .
After learning his own value vi, a player chooses a bid bi(vi) to play in the AdAuctions game.
The strategies continue to assume that players do not overbid, i.e. bi(v)   v (again, since overbidding is weakly dominated).
A set of bidding functions is a Bayes-Nash equilibrium if, for all i, vi, and b(cid:2) i, i(vi), b i(v i))|vi].
E[ui(bi(vi), b i(v i))|vi]   E[ui(b(cid:2) A useful tool for studying revenue in the Bayesian setting is Myerson s Lemma, which can be rephrased in the AdAuctions setting as follows.
Given a distribution F over agent values, the virtual valuation function is de ned by  (x) = x   1 F (x) .
f (x) Lemma 1 (Myerson [21]) At any Bayes-Nash equilibrium of an AdAuction mechanism, we have that, for all i, E[ (i)pi] = E[ (i) (vi)] where pi is the payment per click of player i and  (i) is the number of clicks received by agent i, and expectation is with respect to v   F.
We say that a distribution is regular if  (x) is a monotone non-decreasing function.
For regular distributions, the revenue-optimal mechanism for AdAuctions corresponds to running VCG with Myerson s reserve price r, which is the largest value such that  (r) = 0.
We will refer to this as Myerson s mechanism, V CGr.
Running GSP (or VCG) with reserve price r means not allocating any user with value vi < r and running GSP (or VCG) with the remaining agents.
For the allocated agents, the mechanism charges per click the maximum between the GSP (VCG) price and r.
A special class of regular distributions is the monotone hazard rate distributions (MHR), which are the distributions for which f (x)/(1   F (x)) is non-decreasing.
In this section we consider the revenue properties of GSP at Bayes-Nash equilibrium.
We prove that if agent values are drawn iid from a regular distribution and GSP is paired with an appropriate reserve price, the revenue generated at equilibrium will be within a constant factor of the VCG revenue with optimal reserve, the revenue-optimal mechanism over all Bayes-Nash implementations.
So our result implies that GSP revenue is within a constant factor of the optimal.
We will  rst consider the special case of MHR distributions, then prove our result in the more general setting where values are drawn from regular distributions.
We start by showing that the use of reserve prices is crucial: there are instances in which the GSP auction without reserve generates no revenue, whereas the VCG auction generates positive revenue.
We do note, however, that one can bound the revenue of GSP without reserve prices when click-through rates are well-separated, meaning that there exists a   such that  i+1    i for all i.
We present these bounds in Appendix A of the full version [17].
We start by providing an example in the Bayesian setting where VCG generates positive revenue and GSP has a Bayes-Nash equilibrium that generates zero revenue.
Consider three players with iid valuations drawn uniformly from [1, 2] and three slots with   = [1, 0.5, 0.5].
Let v(i) be the ith largest valuation (which is naturally a random variable de ned by v).
We have
 (v)] = E[0.5v(2) ] = .
Now, consider the following equilibrium of GSP: bi(vi) = 0 for i = 2, 3 and b1(v1) = v1.
Clearly player 1 is in equilibrium.
To see that players i = 2, 3 are in equilibrium, suppose player i has valuation vi > 0.
Then his expected utility when bidding any value in [0, 1] is 0.5vi, whereas if he changed his bid to some b > 1 his utility would be E[ui(b(cid:2), b i)|vi] = 0.5vi + 0.5vi P(v1   b(cid:2) v1dP(v1) = )   = 0.5vi + 0.5vi(b(cid:2)   1)   (b(cid:2)   0.5vi.
(cid:4) b(cid:2) )2   1

   Thus agent i cannot increase his expected utility by placing a nonzero bid.
We now show that if valuations are drawn from a MHR distribution and GSP is paired with the Myerson reserve price, the resulting mechanism extracts a constant fraction of the optimal revenue.
In what follows we will write x+ to denote max{x, 0}.
Theorem 2 If valuations are drawn iid from a MHR distribution F and r is the Myerson reserve price for F , then the expected revenue of GSPr at any Bayes-Nash equilibrium is at least 1 6 of the optimal revenue.
f (x)
   1 F (r) Our proof will make use of the fact that, for MHR distributions,  (x)   x   r for any x   r. To see this, note that x    (x) = f (r) = r by monotonicity and the de nition of Myerson s reserve price.
Proof.
Let b be a Bayes-Nash equilibrium of GSPr, and let Rr(v) be the expected revenue of GSPr at this equilibrium.
Let RV CG (v) be the VCGr revenue.
Let ran-(cid:2) dom variable  (i) denote the slot occupied by player i in the optimal (i.e. e cient) allocation.
By Myerson s Lemma,
 i  (i) (vi)+].
For each player i, let Ei
 denote the event that b ( (i)) < vi/2, and let Ei 2 denote the event that b ( (i))   vi/2.
We will consider each of these events in turn.
For the  rst event, we ll show that player i contributes to the revenue at least 1/2 his contribution in the optimum.
Consider a player i with value vi.
We have (v)] = E[ r r
 ui Ev i vi
  (i) , b i   Ev i   Ev i [ui(b)]   Ev i [ (i)vi] where the  rst inequality is due to the de nition of Ei 1 im- plying that a bid of vi/2 would win slot  (i) (or better) at price no more than vi/2; the second follows since b is a Bayes-Nash equilibrium, and the third comes from the definition of utility.
Notice that all the expectations are taken over v i and vi is a constant, so we can divide by vi, multiply by  (vi)+, take expectations over vi and sum over all players i to obtain (cid:6)
 (cid:0){Ei (cid:5) (cid:5) (cid:7) vi (cid:8)(cid:6) (cid:3) (cid:3) Ev[ (i) (vi) + (cid:0){Ei
 Ev[ (i) (vi) + ] i i = 2Ev[Rr(v)].
(cid:10) We will show that the player who gets slot  (i) contributes to the revenue.
We have
 (cid:0){Ei  (vi)+  (i) (cid:9) Ev i (cid:5) (cid:6)   Ev i
 (cid:0){Ei   Ev i [ (i)v ( (i))]   Ev i [ (i)(r +  (v ( (i)))  (i) vi
 )] where we used the fact that x    (x)+   x   r for all x.
Taking expectations over vi, summing over all players, and noting that event Ei 2 implies that v ( (i))   r, we obtain
 + Ev[ (i) (vi) (cid:3) + (cid:0){Ei
 (cid:3) Ev[ (i) (vi) + ] + 2  (i)r(cid:0){vi   r}.
i i (cid:2) (cid:2) Since GSPr extracts a revenue of at least r per click from every bidder with vi > r, we have Ev[Rr]   Ev[ i  (i)r(cid:0){vi   r}].
We conclude that (cid:0){Ei
 i Ev i [ (i) (vi)+ (cid:11)(cid:3) Combining our analysis for the two events, we have

   2E[Rr(v)] + 4E[Rr(v)] = 6E[Rr(v)].
 (i) (vi) ((cid:0){Ei (v)] = E (cid:12) + r i (cid:3) i   2
 We now show that if player valuations are drawn from a regular distribution, then there exists an r(cid:2) such that running GSP with reserve r(cid:2) extracts a constant fraction of the optimal revenue.
The bound for the MHR bounding the contribution of the player at slot  (i) took advantage of the fact that in a MHR distribution  (x)   x   r, which may not be true in a regular distribution.
Instead, we will use that the player in slot  (i)   1 pays at least the bid in slot  (i).
This leaves us with the added di culty in bounding the revenue generated by the  rst slot.
To address this issue, we make use of the well-studied Prophet Inequalities [13, 14,
 A simpli ed version of the Prophet Inequality is as follows.
Suppose zi are independent non-negative random variables.
Given any t   0, write yt for the value of the  rst zi (by index) satisfying zi > t (or 0 if there is no such zi).
Then the Prophet Inequality states that there exists some t   0 such that E[yt]   1 E[maxi zi].
Since the proof is of this fact is very short, we include it for completness in Appendix B in the full version [17].
As has been noted elsewhere [5], the Prophet Inequality has immediate consequences for the revenue of auctions with anonymous reserve prices.
The following lemma encapsulates the observation we require.
Lemma 3 If vi are drawn iid from a regular distribution then there exists r2   0 such that, writing Z for the event that maxi vi   r2, E[maxi  (vi)+|Z]P(Z)   1 E[maxi  (vi)+].
Proof.
(sketch) This follows by applying the Prophet Inequality to virtual values zi =  (vi) and noting that regularity implies that vi   r2 i   (vi)    (r2).
It is important to remark that the proof of the Prophet Inequality is constructive.
If one is able to e ciently compute E[(vi t)+] for every t, then we can compute r2 exactly using binary search.
We refer to the appendix in the full version [17] for details.
Our approach will now be to analyze the revenue of GSP under two di erent reserve prices.
An argument similar to Theorem 2 shows that GSP with Myerson reserve obtains a constant fraction of the optimal revenue for all slots other than the  rst slot.
On the other hand, GSP with reserve r2 from Lemma 3 will obtain at least half of the optimal revenue generated by the  rst slot.
One of these two reserve prices must therefore generate a constant fraction of the optimal revenue.
Theorem 4 If valuations vi are drawn iid from a regular distribution F , then there is a reserve price r such that the expected revenue of GSPr at any Bayes-Nash equilibrium is at least 1 6 of the optimal revenue.
(v), Rr(v), and  (i) as in Theorem Proof.
De ne RV CG
 erson s Lemma, E[RV CG i  (i) (vi)+].
For each player i, we de ne the following three events: (v)] = E[ (cid:2) r r   Ei   Ei   Ei 1 = { b ( (i)) < vi/2 and  (i) (cid:9)= 1 } 2 = { b ( (i))   vi/2 and  (i) (cid:9)= 1 } 3 = {  (i) = 1 } (cid:3) We wish to bound the virtual value of the optimal allocation, conditioning on each of these events in turn.
For the  rst event, we proceed precisely as in Theorem 2 to obtain Ev i [ (i) (vi) + (cid:0){Ei
 i + (cid:0){Ei For the second event, we use the revenue from slot  (1)   1.
Let random variable pi denote the payment per click of the player in slot i.
Then for all v,


  (i) (vi) where the second inequality follows since Ei 2 implies p (i) 1 = b (i)   vi/2.
Therefore, summing over all agents i and tak-(cid:12) ing expectations, we get
 (cid:0){Ei = 2E[Rr1 ].
(cid:11)(cid:3) (cid:11)(cid:3)   2Ev  (i) (vi)  ipi (cid:12) Ev + i i Finally, for event Ei 3, consider setting the reserve price to be r2 from the statement of Lemma 3 (with distribution F ).
Note that (cid:11)(cid:3)
 i (cid:12)
 (cid:0){Ei  (i) (vi) + =  1E[max i  (vi) + ].
On the other hand, setting reserve price r2 for GSP we get vi   r2) E[Rr2 ]    1E[max vi   r2]P(max + | max  (vi) i i i   1
  1E[max i  (vi) + ] where the  rst inequality follows by considering only the expected virtual value due to the  rst slot and the last inequality follows from Lemma 3.
Combining our analysis for each of the three cases, we have


 (cid:11)(cid:3) ((cid:0){Ei
 (cid:12) + r  (i) (vi)
   4E[Rr1 ] + 2E[Rr2 ] i

 r ].
We now wish to compare the revenue properties of GSP and VCG in the full information setting.
We start by giving examples showing that there are no universal constants that bound these two quantities.
Then we introduce a new benchmark related to VCG, and show that the GSP revenue is not too low relative to this benchmark.
Unfortunately, there are no universal constants c1, c2 > 0 such that for every full information AdAuctions instance  , v and for all equilibria b of GSP it holds that c1   RV CG (v)   R(b)   c2   RV CG (v).
In fact, GSP can generate arbitrarily more revenue than VCG and vice-versa.
For example, consider two players with   = {1, 0}, v = {2, 1}.
Then VCG generates revenue 1, but GSP has the Nash equilibrium b = [2, 0] that generates no revenue.
As a counterexample for the second inequality, consider the following instance:   = {1, 1   }, v = { 1, 1}.
Notice that the revenue produced by VCG is , while GSP has the equilibrium b = [1, 1] generating revenue 1.
Next, we will prove that the GSP revenue cannot be much less than a revenue benchmark based on the VCG auction.
Intuitively, the di culty behind our bad examples is in extracting revenue from the player with the largest private value.
Motivated by this, we consider the following benchmark: B(v) = pV CG i  (i) = ( j 1    j )vj n(cid:3) (cid:3) i=2 j>i (i   2)( i 1    i)vi n(cid:3) n(cid:3) i=2 = i=2 which is the VCG revenue from players 2, 3, .
.
.
, n. Recall that in the full information setting we assumed that players are numbered such that v1   v2   .
.
.. We show that the GSP revenue is always at least half of this benchmark at any equilibrium.
Thus, unless VCG gets most of its revenue from a single player, GSP revenue will be within a constant factor of the VCG revenue.
Theorem 5 Given an AdAuctions instance  , v, and a Nash equilibrium b of GSP, we have R(b)   1 B(v), and this bound is tight.
We prove Theorem 5 in two steps.
First we de ne the concept of up-Nash2 equilibrium for GSP, then we show that any ine cient Nash equilibria can be written as an e cient up-Nash equilibrium.
In the second step, we prove the desired revenue bound for all e cient up-Nash equilibria.
De nition 6 Given a bid pro le b, we say it is up-Nash for player i if he can t increase his utility by taking some slot
 similar to the concepts of upwards stable and downwards stable equilibria in Markakis and Telelis [20] above, i.e.
 (i)(vi   b ( (i)+1))    j (vi   b (j)), j <  (i).
Analogously, we say that b is down-Nash for player i if he can t increase his utility by taking some slot below, i.e.
 (i)(vi   b ( (i)+1))    j (vi   b (j+1)), j >  (i).
A bid pro le is up-Nash (down-Nash) if it is up-Nash (down-Nash) for all players i.
Clearly a bid pro le b is a Nash equilibrium i  it is both up-Nash and down-Nash.
where b(cid:2) i = b (i) is up-Nash.
Lemma 7 If a bid pro le b is a Nash equilibrium, then the (cid:2) bid pro le b Proof.
We will prove the lemma by modifying bid pro le b in a sequence of steps.
Fix some k   n, and suppose that b is a bid pro le (with corresponding allocation  ) such that   players j = 1, .
.
.
, k satisfy the Nash conditions (i.e.
both up-Nash and down-Nash) in b,   players j = k + 1, .
.
.
, n are such that  (j) = j and they satisfy the up-Nash conditions in b,    (k) < k.
(cid:2) by swapping the bids of players k and We then de ne b i = bi for i (cid:9)= k,  (k), b(cid:2)  (k), that is setting b(cid:2) k = b (k), and b(cid:2) (cid:2) is up-Nash for players k, .
.
.
, n  (k) = bk.
We claim that b and Nash for the remaining players.
This then implies the desired result, since we can apply this operation for k = n, followed by k = n   1, .
.
.
, 2, resulting in the required bid pro le.
Since our transformation does not alter the bids associated with given slots, we just need to check three things: the up and down-Nash inequalities for player  (k), and the up-Nash inequality for player k.
(cid:2) Under bid pro le b , player  (k) gets slot  (k).
This player doesn t want to change his bid to win any slot j >  (k) since in the bid pro le b player k with lower value didn t want to get these slots.
We therefore have  (k)(vk   b ( (k)+1))    j (vk   b (j+1)) and since v (k)   vk, we conclude  (k)(v (k)   b ( (k)+1))    j (v (k)   b (j+1)).
(1) To see that player  (k) would not prefer to take any slot j <  (k), notice that  (k) didn t want to move to a higher slot in b, so  k(v (k)   b (k+1))    j (v (k)   b (j)).
This, combined with equation (1) for j = k (stating that  (k) prefers slot  (k) to k) gives the up-Nash inequality for player  (k).
(cid:2) Next consider player k in bid pro le b , where we gets slot k. We wish to prove the up-Nash inequality for k. Notice that, in b,  (k) had slot k and didn t want to switch to a higher slot, so we know  k(v (k)   b (k+1))    j (v (k)   b (j)).
Now, since v (k)   vk, we have  k(vk b (k+1))    j (vk  b (j)) which is the desired inequality.
Now to prove Theorem 5 we use the up-Nash pro le b(cid:2) .
Proof of Theorem 5 : Given any Nash equilibrium b, (cid:2) consider the bid pro le b of Lemma 7, which is an up-Nash equilibrium in which each player k occupies slot k. By the up-Nash inequalities, for each k we have k+1)    k 1(vk   b(cid:2)  k(vk   b(cid:2) k 1).
 k 1b(cid:2) k 1   ( k 1    k)vk +  kb(cid:2) k+1.
Then, since  k    k+1, k 1    k 1b(cid:2) (cid:3) j k+2N ( j 1    j )vj where k + 2N = {k, k + 2, k + 4, .
.
.}.
Now we can bound the revenue of b: (cid:3) R(b) = R(b (cid:2) ) =   k (cid:3) (cid:3)   n(cid:3) k k=2 k+1    kb(cid:2) (cid:3)  k+1b(cid:2) k+1   ( j 1    j )vj   k j k+2+2N k   2
 ( k 1    k)vk = B(v).
To show that the bound in Theorem 5 is tight, consider the following example with n slots and n players, parametrized by   > 0:   = [1, 1, .
.
.
, 1, 1    , 0], v = [1, 1, .
.
.
,1 , 1,  ], b = [ ,  , .
.
.
,  ,  , 0].
In this case R(b) = (n   2)  +  (1    ) and RV CG(v) = (2     2)(n   3) +  (1    ).
Therefore limn  R(b)B(v) = 2     and it tends to 2 as     0.
Notice that those bounds also carry for the case where there is a reserve price r. We compare the revenue Rr(b) with reserve price r, against a slightly modi ed benchmark: Br(v) which is the revenue VCGr extracts from players 2, .
.
.
, n.
 Corollary 8 Let b be a Nash equilibrium of the GSPr game, then Rr(b)   1 Br(v).
Proof.
We can assume wlog that vi, bi   r (otherwise those players don t participate in any of the auctions).
We (cid:2) can de ne an upper-Nash bid pro le b as in Lemma 7.
Now, (cid:2) are paying at least r per click.
notice that all players in b We can divide the players in two groups: players 1 .
.
.
k are paying more than r in VCGr and players k + 1 .
.
.
n are paying exactly r. It is trivial that for the players k + 1 .
.
.
n we extract at least the same revenue under VCGr then under GSPr.
For the rest of the players we need to do the exact same analysis as in the proof of Theorem 5.
In this section we consider the tradeo  between e ciency and revenue, and ask if optimal e ciency and optimal revenue can always be achieved in the same equilibrium.
We give a negative answer to this question, showing that for some AdAuction instances, one can increase revenue by selecting ine cient equilibria.
First we recall the equilibrium hierarchy brie y discussed in the introduction.
Then we characterize the maximum revenue possible for envy free equilibrium (that is always e cient).
Does this equilibrium class generate more or less revenue than other classes, such as e cient equilibria or all pure equilibria?
This question of comparing the revenue of VCG and envy-free equilibria of GSP was addressed by [7], who show that the revenue in any envy-free equilibrium is at least that of the VCG outcome (i.e. the VCG outcome is the envy-free equilibria generating smallest possible revenue).
Moreover, as we ve shown, an envy-free equilibrium can generate arbitrarily more revenue than the VCG outcome.
Varian [26] shows how to compute the revenue optimal envy free Nash equilibrium, if we assume that agents will overbid.
Allowing overbidding can result in very high revenue (eg.., the maximum valuation in a single item auction).
Here we determine the maximum revenue that can be obtained if we do not assume that agents bid at envy-free equilibria, and without requiring that agents apply the dominated strategy of overbidding.
Finally, we use this characterization to we give a natural su cient condition under which there is a revenue-optimal equilibrium that is e cient.
Edelman, Ostrovsky and Schwarz [7] and Varian [25] showed that the full information game always has a Pure Nash equilibrium, and moreover, there is a pure Nash equilibrium which has same outcome and payments as VCG.
At this equilibrium, players bid n(cid:3) j=i bV i =
  i 1 ( j 1    j )vj .
The authors also de ne a class of equilibria called envy-free or symmetric equilibria.
This is the class of bid pro les b such that  (i)(vi   b (i)+1)    j (vi   bj+1).
It is easy to see that all envy-free equilibria are Nash equi-libria, though not all Nash equilibria are envy-free.
The bid pro les that are envy-free are always e cient and the revenue of an envy-free equilibrium is always greater than or equal to the VCG revenue.
That is, if b is an envy-free equilibrium, R(b)   RV CG(v).
Although all envy-free equilibria are e cient, there are e cient equilibria that are not envy-free, as one can see for example in Figure 1, as well as ine cient equilibria.
We therefore have the following hierarchy: (cid:13)
 outcome envy-free equilibria e cient Nash eq all Nash (cid:14) (cid:13)   (cid:14) (cid:13)   (cid:14) (cid:13)   (cid:14)
 As shown in the example of Figure 1, there are e cient equilibria that generate arbitrarily less revenue then any envy-free equilibrium.
For the other direction, we show that all revenue-optimal e cient equilibria are envy-free.
Theorem 9 For any AdAuctions instance such that  i >  i+1 i, all revenue-optimal e cient equilibria are envy-free.
Moreover, we can write the revenue optimal e cient equilibrium explicitly as function of  , v recursively as follows: (cid:14) (cid:13) (cid:13)  n 1    n  n 1  i 1    i  i 1 bn = min vn, vn 1 , bi = min vi, vi 1 +  i  i 1 bi+1 (cid:14)  i < n.
v (1    ) (1    )v (1    )v (1    ) v b1 Figure 1: Equilibria hierarchy for GSP for   = [1, 1/2], v = [1, 2/3]: the strong blue dot represents the VCG outcome, the pattern region the envy-free equilibria, the blue region all the e cient equilibria and the red region the ine cient equilibria Proof.
Given an e cient equilibrium b, if it is not envy-free, we show that we can improve revenue by slightly increasing one of the bids.
If the equilibrium is not envy-free, there is at least one player that envies the player above, i.e.
 i(vi   bi+1) <  i 1(vi   bi).
As pointed out in [7], if in an e cient equilibrium no player envies the above slot (i.e. no player i wants to take the above slot i   1 by the price per click player i is paying) then the equilibrium is envy-free.
Let i be the player with the smallest index that envies slot i   1.
Consider the bid pro le b j = bj for j (cid:9)= i (cid:2) and b(cid:2) i = bi + .
We will verify that the Nash inequalities for player i   1 still hold when  > 0 is su ciently small.
In other words, we will show that no Nash inequality for player i   1 holds with equality in b.
such that b(cid:2) For slots j > i   1, notice that  j(vi   bj+1)    i(vi   bi+1) <  i 1(vi   bi) where the  rst is a standard Nash inequality and the second is the hypothesis that player i envies the above slot.
Now, since vi 1 > vi in an e cient equilibrium, we have  j (vi 1   bj+1) <  i 1(vi 1   bi).
For slots j < i   1, we use the fact that player i is the  rst envious player.
Also, without loss of generality, we can assume player 1 bids v1.
Therefore we need to verify the Nash inequalities only for j = 2, 3, .
.
.
, k   1.
We have  i 1(vi   bi)    j (vi   bj+1) >  j(vi   bj) where the  rst inequality comes from the fact that player i  1 doesn t envy any player j above him and the second inequality comes from the fact that bj > bj+1, since otherwise the player in slot j would envy the player in slot j   1.
This shows that the revenue optimal equilibrium is envy free.
To see that the bid pro le de ned in the theorem is optimal, we need to show the following things about this bid pro le b: (i) it is in Nash equilibrium, (ii) it is envy free, and (iii) no other e cient Nash equilibrium generates higher revenue.
Begin by noticing that if b is Nash, then player i   1 doesn t want to take slot i, for all i, and therefore  i 1(vi 1   bi)    i(vi 1   bi+1) and this is satis ed by de nition by the bid vector presented.
Notice also that this series of inequalities implies an upper bound on the maximum revenue in an e cient equilibrium and this bound is achieved exactly by the bid pro le de ned above.
Furthermore, for all j   i   1 we have  i 1(vj   bi)    i(vj   bi+1) therefore by composing this expression with di erent values of i and j, it is straightforward to show that no player can pro t by decreasing his bid.
We prove that no player can pro t by overbidding as a simple corollary of envy-freeness.
For that, we need to prove that  i(vi   bi+1)    i 1(vi   bi).
If bi = vi than this is trivial.
If not, then substitute the expression for bi and notice it reduces to vi 1   vi.
Now, this proved local envy-freeness, what implies that no player wants the slot above him by the price he player above him is paying.
This in particular implies that no player wants to increase his bid to take a slot above.
Next we will analyze the relation between revenue and e ciency in GSP auctions.
We de ne the cost of e ciency for a given pro le of click-through-rates as CoE( ) = max v maxb Nash( ,v) R(b) maxb EffNash( ,v) R(b) where Nash is the set of all bid pro les in Nash equilibrium and EffNash is the set of all e cient Nash equilibrium.
First we give examples in which CoE( ) > 1, in which case all revenue-optimal equilibria occur at ine cient equi-libria.
Our example will have n = 3 slots and advertisers.
The click-through rates are given by   = [1, 2 6 ] and
 the agent types are v = [1, 7 In this case, the best
 possible revenue generated by an e cient outcome is given   1.20833 (this can be calculated using the for-by 1 mula in Theorem 9).
However, for the (ine cient) allocation   = [2, 1, 3], there is an equilibrium that generates revenue

 , 6
 , 1
 In Figure 2 we calculate this value empirically for each   = [1,  2,  3], where each  i is an integer multiple of 0.01 in [0, 1].
In all cases we found that 1   CoE( ) < 1.1.
The color of ( 1,  2) in the graph corresponds to CoE(1,  2,  3), where blue represents 1 and red represents 1.1.
By solving a constrained nonlinear optimization problem, one can show that the worst CoE for 3 slots is 1.09383.
Through-Rates are Convex We now present a condition on   that implies CoE( ) =
 meaning that  i    i+1    i+1    i+2 for all i.
We note that most models for CTRs studied in the literature satisfy convexity, such as exponential CTRs [15] and Markovian user models [1].
Theorem 10 If click-through-rates   are convex then there is a revenue-maximizing Nash equilibrium that is also e -cient.
(cid:3) j i( j    j+1)vm( ,i,j), and hence R(b (cid:2)  (i+1)   (cid:3) (cid:3)  ib(cid:2) ) = i i j i ( j    j+1)vm( ,i,j).
(3) Notice that equation (3) can also be written as a dot product between two vectors of type vi and  j    j+1.
If we sort the vectors, we see that the ( j    j+1)-vector is the same in both (2) and (3).
Moreover, the sorted vector of vj for equation (3) is dominated by that of equation (2), in the sense that it is pointwise smaller.
To see this, simply (cid:2)i count how many times we have one of v1, .
.
.
, vi appear in j=1 1 + max{p | m( (j, j + p))   i}  (cid:2)i (cid:2)i both vectors for each index i: for equation (2) they appear j=1 j times, whereas for equation (3) they appear at most j=1 j times.
Since the ( j    j+1)-vectors are the same in both equations, the vi vector in the  rst equation dominates the order and in the  rst equation both vectors are sorted in the same order, so it must be the case that R(b)   R(b (cid:2) ).
It remains to remove our simplifying assumption about saturation and prove the general result.
Let b be the optimal e cient equilibrium and let S   [n + 1] be the set of saturated bids, including n + 1 (where we consider a  fake  player n + 1 with bn+1 = vn+1 = 0), i.e., i   S i  bi = vi.
Let S(i) = min{j   S; j > i}.
Given an allocation  , we wish to de ne an upper bound, R , on the revenue of a bid pro le that induces allocation   at equilibrium.
To this end, we de ne      S(j) 1vS(j) +  S(j) 1vS(j)   vj( S(j) 1    (j)) (cid:2)S(j) 2 i= (j) ( i    i+1)vm( , (j),i) if  (j)   S(j)   1 if  (j)   S(j)   1 (cid:3) We then de ne B (j) = R  = B (j).
j We claim that this is, indeed, an upper bound on revenue.
Moreover, this bound is tight for revenue at e cient equi-libria (i.e. when   is the identity id).
Claim 11 If bid pro le b induces allocation   at equilibrium, then R(b)   R .
Claim 12 There exists an e cient equilibrium with revenue Rid.
Using these two claims we want to argue that id is the permutation that maximizes R  and therefore we can show (cid:2) that for all ine cient bid pro le b we have )   R    Rid = R(b).
R(b (cid:2) such that  (cid:2) (k) =  (k) for k <  (j) and  (cid:2) To show this, consider some permutation  .
Let j = max{k :  (k) (cid:9)= k} and de ne a permutation  (cid:2) (k) = k for k   j and  (cid:2) (k) =  (k +1) for  (j)   k < j.
Essentially this is picking the last player that is not allocated to his correct slot and bring him there.
Now, if we prove that R (cid:2)   R , then we are done, since we can repeat this procedure many times and get to id.
Claim 13 R (cid:2)   R .
This completes the proof, subject to our claims, which we prove in Appendix C of the full version [17].
Figure 2: Cost of e ciency for   = [1,  2,  3]: in the plot, blue means 1.0 and red means 1.1.
Our proof follows from a local improvement argument: given an instance with convex click-through-rates and an equilibrium that is not e cient, we show how to either improve it revenue or its welfare.
A key step of the proof is bounding the maximum revenue possible in equilibrium for a given allocation, extending Theorem 9 to ine cient allocations.
Proof.
Let b be the revenue maximizing e cient Nash (cid:2) equilibrium.
Fix an allocation   and let b be an equilibrium under allocation  .
We say that b is saturated for slot i if bi = vi.
We start by presenting the proof of the theorem under the simplifying assumption that no slot is saturated in the maximum revenue equilibrium..
Under the no-saturation assumption, Theorem 9 implies R(b) =  ibi+1 = ( j    j+1)vj.
(2) (cid:3) (cid:3) j i i (cid:3) i Notice that we can view this expression as a dot product of two vectors where one has elements of the form vi and other has elements in the form  j    j+1.
Notice also that due to the convexity assumption, this is a dot product of two (cid:2) sorted vectors.
Now, for b , we will bound revenue as follows.
De ne m( , i, j) = max{ (i),  (i + 1),  (i + 2), .
.
.
,  (j)}.
Let p be such that the k = i, i + 1, .
.
.
, i + p are all the indices such that m( , i, k) =  (i).
Now, notice that the player in slot i doesn t want to take slot i + p + 1, so  i(v (i)   b(cid:2)  (i+1))    i+p+1(v (i)   b(cid:2)  (i+p+2)).
This implies  ib(cid:2)  (i+1)    i+p+1b(cid:2) =  i+p+1b(cid:2)  (i+p+2) + ( i    i+p+1)v (i)  (i+p+2) + ( j    j+1)vm( ,i,j).
