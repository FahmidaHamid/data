The Internet has been and is still changing unexpectedly in many aspects.
Started with elastic traf c and applications, e.g., emails and webpage downloading, we have seen signi cant rise in inelastic traf c, e.g., video and interactive web traf c, across the Internet.
According to [19], from 2007 to 2009, web content traf c had increased from 41.68% to 52%, reaching more than half of the total Internet traf c.
From a network perspective, the Internet originated from government-owned backbone networks, i.e., the ARPANET, and then evolved to a network of commercial Autonomous Systems (ASes) and Internet Service Providers (ISPs).
Meanwhile, ISPs formed a hierarchical structure and were classi ed by tiers, with higher tier ISPs cover larger geographic regions and provide transit service for smaller/lower tier ISPs.
However, recent study [17] has reported that large content providers, e.g., Google and Microsoft, are deploying their own wide-area networks so as to bring content closer to users and bypassing Tier-1 ISPs on many paths.
This is known as the  attening phenomenon of the Internet topology.
Copyright is held by the International World Wide Web Conference Committee (IW3C2).
IW3C2 reserves the right to provide a hyperlink to the author s site if the Material is used in electronic media.
Changes in the content or network topology do not happen independently.
Rather, they are driven by the changes in the business relationships among the players in the Internet ecosystem.
Not surprisingly, we have observed dramatic changes in the business relationships between the content providers and the ISPs and among the ISPs themselves.
Traditionally, ISP settlements were often done bilaterally under either a (zero-dollar) peering or in the form of a customer-provider relationship.
Tier-1 ISPs, e.g., Level 3 [5], often charge lower tier ISPs for transit services and connect with each other under settlement-free peering.
However, the Tier-1 ISPs do not have any guarantee in their pro tability as the Internet evolves.
For instance, we have seen exponential decrease (around 20% a year) in IP transit prices [23].
Also, peering disputes happened, e.g., the de-peering between Cogent [3] and Level 3 in 2005, where the lower tier ISPs that are closer to content or users refused to pay for the transit charge.
This leads to the recent debate of network neutrality [26], which re ects the ISPs  willingness to provide value-added and differentiated services and potentially charge content providers based on different levels of service quality.
The situation is further complicated by the emergence of new players in the ecosystem: Content Delivery Networks (CDNs), e.g., Akamai [1] and Limelight [6], and high-quality video streaming providers, e.g., Net ix [7].
From content providers  perspective, CDNs can deliver their content faster and more ef ciently; from local ISPs  perspective, CDNs can reduce the traf c volume from upstream, saving transit costs from their providers.
Very often, ISPs do not charge the CDNs for putting servers in their networks.
When the video streaming giant Net ix moved online a few years ago, its traf c surged immediately.
Now it accounts for up to 32.7% of peak U.S. downstream traf c [8] and its traf c volume is higher than that of BitTorrent [9] applications.
Net ix used Limelight, one of the biggest CDNs, for content delivery, and later, the Tier-1 Level 3 also obtained a contract to deliver Net ix s traf c.
Since most of the Net ix customers are based in the U.S., they often use Comcast, the biggest access ISP, as the last-mile access provider.
Interestingly, Comcast managed to enter a so-called paid-peering relationship [16] with Level 3 and Limelight, under which the Tier-
on the last mile connection.
This has totally reversed the nominal customer-provider relationship where the Tier-1 ISP was the service provider and should have received payment for connectivity.
It is important to understand how these changes come about, and what the driving factors are behind these changes.
In this work, we model the Internet evolution from a macroscopic view that captures the cause and effect of the evolution of the individual players in the ecosystem.
Our model expends the traditional view of a single best-effort service model to capture multiple value-added services in the Internet.
The main approaches and contributions are as follows.
plication providers for purchasing Internet services, based on the application characteristics and the price and quality of the transport services (Section 2).
  We characterize the market price and the market share of the Internet transport services by using general equilibrium theory in economics (Section 3).
  We analyze the driving forces of the evolution of the Internet economic ecosystem (Section 4), which provide qualitative answers (Section 4.6) to questions like: 1) Why have the IP transit prices been dropping?
2) Why have the CDNs emerged in the ecosystem?
3) Why has the pricing power shifted to the access ISPs?
4) Why are the large content providers building their own wide-area networks toward users?
  We incorporate Internet price and capacity data into our model, and quantitatively  t historical prices and project the future evolution of the ecosystem and its price trends (Section 5).
  We demonstrate how our model can help the network providers to make business decisions, e.g., capacity expansion and peering decisions, based on the future price projections under various scenarios (Section 5.3).
Our paper sheds new light on the macroscopic evolution of the Internet economic ecosystem and concretely identi es the driving factors of such an evolution.
In particular, our model provides a tool to analyze and project the evolutionary trends of the ecosystem.
The fundamental understanding of the preferences of application providers and the market equilibrium of the Internet services will also help the business decisions of the application and network transport providers to succeed in this competitive ecosystem.
We start with a macroscopic model of the Internet ecosystem that consists a set of Application Providers (APs) and Transport Providers (TPs).
The TPs differ by their service qualities and the prices they charge.
We model and analyze the APs  choice of TP based on their own characteristics: how pro table the AP is and how sensitive the AP traf c is to the obtained level of service quality.
In essence, this macroscopic model can help us to understand the decision process of these players in the Internet ecosystem and how these decisions may in uence their business relationships.
We consider an Internet service market of a geographic region and denote (M, N ) as a macroscopic model of the ecosystem, consisting of a set M of TPs and a set N of APs.
The APs provide the content/service for the Internet end-users; the TPs provide the network infrastructure for delivering the APs  data to their end-users.
Our notion of an AP broadly includes content providers, e.g., Net ix, online services, e-commerce, and even cloud services, e.g., Amazon EC2 [2].
Our notion of a TP is based on the APs  point of view.
In other words, the transport services provided by the TPs are for the APs to reach their customers/users.
The scope of a TP is broader than an ISP, and it includes CDNs.
ISPs, depending on different taxonomies [16, 15, 21], include 1) eyeball/access ISPs that serve the last-mile for end-users, 2) backbone/Tier 1 ISPs that provide transit services for lower tier ISPs, and 3) content ISPs that serve APs and host content servers.
A TP can be an ISP of any type.
Although access and transit ISPs traditionally do not have business relationships with APs explicitly, with the emergence of video streaming APs, e.g., Net ix, we have seen more and more APs  direct or indirect contracts with the access and transit ISPs.
For example, Level 3 contracted with Net ix for content delivery and Comcast managed to charge Level 3 and Limelight via paid-peering contracts (for delivering Net ix s traf c to Comcast s customer base faster) [23].
Although  whether ISPs should be allowed to differentiate services/charges for APs  is hotly debated under the network neutrality [26] argument, legitimate service differentia-tions will also induce more extensive business relationships among the APs and ISPs.
In general, a TP can be any facilitator that delivers content to end-users.
An important example of a TP that does not even own network infrastructures in the current Internet ecosystem is Akamai [1], which represents the CDNs.
We characterize each TP I   M by its type, denoted as a triple (pI , qI ,  I ).
pI denotes the per unit traf c charge for the APs to use TP I. qI denotes the service quality of TP I, e.g., queueing delay or packet loss probability.
Without loss of generality, we assume that qI   0 and smaller values of qI indicate better quality of services.
 I denotes the bandwidth capacity of TP I.
We characterize each AP i   N by its utility function ui( ).
In particular, we de ne ui(pI, qI ) as AP i s utility when it uses TP I, which depends on the service quality qI and the per unit traf c charge pI .
Assumption 1. ui( ,  ) is non-increasing in both arguments.
Assumption 2.
For any set M of TPs, each AP i   N chooses to use a TP, denoted as Ii   M, that satis es ui(pIi , qIi )   ui(pI , qI ),   I   M.
The above assumes that each AP is rational and chooses a TP that provides the highest utility.
Technically, there might exists multiple TPs that provide the same amount of utility for the AP.
We assume that every AP has certain preference to break the tie and choose one of the TPs.
We further denote NI   N as the set of APs that choose to use TP I, or the market share of TP I, de ned as NI = {i   N : Ii = I}.
Based on Assumption 1 and 2, if two TPs I, J have the same quality, i.e., qI = qJ , then they have to price equally, i.e., pI = pJ ; otherwise, the one with higher price will not obtain any market share.
As TPs differ only by price pI and quality qI from the APs  perspective, we aggregate the TPs that have the same value pair (pI , qI ) into a single TP with a capacity that equals the summation of individual TPs  capacity.
Similarly, if a TP performs service differentiations, we conceptually treat it as multiple TPs, each with a service class (pI , qI ) and the corresponding capacity  I .
More precisely, our abstraction of a TP I models a competitive market segment that provides a quality level qI and has a total capacity  I .
Although the utility function ui can be used to model all the characteristics of AP i, the setting does not yet capture the traf- c dynamics and the pro tability of the APs.
We model AP i s pro tability by denoting vi as its per unit traf c revenue.
This revenue is related to the AP s core business, e.g., online adverting or e-commerce, and we do not assume how it is generated.
We denote  i( ) as AP i s throughput function, where  i(qI ) de nes the aggregate throughput of AP i toward its consumers under a quality level qI .
Thus, we model any AP i s utility as its total pro t (pro t margin multiplied by the total throughput rate), de ned by ui(pI , qI ) = (vi   pI ) i(qI ).
(1) Assumption 3.
For any AP i   N ,  i( ) is a non-increasing function with  i = limqi 0  i(qi) and limqi   i(qi) = 0.
AP uses a better service.
 i reaches a maximum value of  i when it receives the best quality qi = 0 and decreases to zero if the quality deteriorates in nitely, i.e., qi tends to + .
In particular, we consider the following canonical form of the throughput function:  i(qI ) =  ie iqI , (2) where AP i s throughput is characterized by a parameter  i that captures its sensitivity to the received quality qI .
I   M} and N   = {( i,  3 i,  1vi +  2) : i   N }, then system (M , N  ) satis es NI (M , N  ) = NI (M, N ) for all I   M.
Theorem 2 says that if 1) the AP pro tability vi and the TP price pI are linearly scaled in the same way, and/or 2) the quality qI of the TPs and the sensitivity  i of the APs scale inversely at the same rate, then the APs  choices of TP will not change.
This result will help us normalize different systems and make a fair comparison of various solutions.
Theorem 3.
For any   > 0 and a  xed set N of APs, let M  = {(pI ,  qI ,  I ) : I   M}, then for all i   N , 1) qI      qIi if   > 1 and 2) qI      qIi if   < 1.
i i Theorem 3 says that if all the qualities in the market deteriorate (  > 1) linearly at the same rate, APs will not use worse quality TPs than before.
The opposite is also true: when qualities improve linearly, APs will not use better quality TPs than before.
In this section, we start with the de nition of a market equilibrium, under which the prices of the TPs are stable and the claimed service qualities can be achieved when APs choose their best TPs.
We then proceed to characterize the market equilibrium and calculate the equilibrium prices.
Although any TP I claims to provide service quality qI , it cannot keep its promise if more APs choose this TP than its capacity can support.
We model the achieved quality QI ( I ,  I ) as a function of the actual throughput  I going through I and its capacity  I .
Assumption 4.
The achieved quality QI ( I ,  I ) for any TP I   M is non-decreasing in  I and non-increasing in  I .
De nition 1.
A set X   N of APs is feasible for TP I with quality qI , if QI(cid:0) I (X ),  I(cid:1)   qI , where  I (X ) = Pi X  i(qI ) de nes the induced throughput of the set X of APs under quality qI .
In a market M of TPs, each TP would adjust its strategies to accommodate its customer APs  traf c demand and keep its service quality promise.
For example, if the current capacity of TP I cannot support quality qI , it might 1) expend its capacity  I , 2) increase price pI , or 3) reduce the quality level qI .
Next, we de ne a market equilibrium where the APs  demand are feasible and the TPs  strategies are stable.
       
 I   pmin I ),  I(cid:1)   qI ,  I (N De nition 2.
Let pmin be the cost (or minimum price) of TP I.
Let M  be identical to M except for p  I 6= pI for some I   M I be the set of APs choosing TP I under M .
A system and N (M, N ) forms a market equilibrium if 1) all APs  aggregate demands are feasible, i.e., QI(cid:0) I (NI ),  I(cid:1)   qI ,  I   M, and 2) each price pI maximizes the utilization of capacity for acceptable throughput at TP I, i.e., for any p  with the corresponding I )    I (NI ).
I satisfying QI(cid:0) I (N One way to understand the above de nition of a market equilibrium is that given a set N of APs and a set {qI : I  M} of service qualities for them to choose from, the price pI and capacity  I of each market segment should be consistent in that 1) when the APs make their choices of TP, their expected service quality can be achieved and, 2) the capacities of the TPs are not underutilized, unless the charge pI reaches the TP s cost pmin .
If APs  quality expectations are not ful lled, their choices of TP will change.
Furthermore, if capacity  I is underutilized with pI > pmin , then the market segment I is not correctly priced.
That being said, we assume that none of the market segment is controlled by a monopoly,

 Figure 1: Throughput of different type of APs.
Figure 1 illustrates the throughput of two APs with parameters ( 1,  1) = (10, 1.0) and ( 2,  2) = (6, 0.1) under varying service qualities, interpreted as network delays in this case, along the x-axis.
AP 1 represents a Net ix-type of application that is more sensitive to delay and has a high maximum rate  1 = 10 Mbps; however, AP 2 represents a Google-type of query application that is less sensitive to delay.
We observe that when delay increases, the throughput of delay-sensitive application decreases sharply, while the delay-insensitive application decreases only mildly.
Because  i is just a linear scaling factor of the throughput, it does not affect the AP s preference over different TPs.
Consequently, APs with the same ( i, vi) value pairs will choose the same TP; and therefore, we can conceptually aggregate them as a single AP.
Similar to a TP I representing a market segment, each AP i can be interpreted as a group of APs with the same characteristics and  i represents the aggregate maximum traf c intensity, which depends on the number of APs in the group and the individual traf c intensities.
Although  i does not play a role in the AP s decision of choosing TPs, we will see later that  i re ects the demand of the APs and affects the market prices of the TPs.
In summary, based on our throughput model, we de ne ui(pI, qI ) = (vi   pI ) i(qI ) =  i(vi   pI )e iqI .
(3) Similar to each TP I s type (pI , qI ,  I ), we can characterize any AP i s type as another triple ( i,  i, vi).
When facing a set M of TPs, each AP i s best choice Ii depends on the price-quality pairs {(pI , qI ) : I   M} and its own characteristics ( i, vi).
The APs  choices satisfy the following results.
Theorem 1.
For a  xed set M and any two APs i and j with  j    i and vj   vi, their chosen service qualities satisfy qIi   qIj .
Theorem 1 says that if an AP j is more pro table and more sensitive to service quality than another AP i, then the chosen quality of AP j will be at least as good as that of AP i.
This property holds regardless how the services are priced.
Theorem 2.
For any  1,  2,  3 > 0, and system (M, N ), we de- ne a scaled system (M , N  ) as M  = {( 1pI + 2, qI / 3,  I ) : 851which might want to under-utilize capacity and keep a higher price for pro t-maximization.
We will summarize and discuss the limitations of our model in Section 5.4.
The interesting aspect here is that although pI , like all other prices, mainly depends on the supply  I and the demand NI of the APs, all the TPs (or market segments) are correlated, which serve substitutions for the APs.
In practice, the TPs might not have enough capacities to accommodate all APs.
As a result, market prices will rise and some APs cannot afford the prices and will not use any of the TPs.
However, under Assumption 2, each AP needs to choose a TP even it cannot afford to use any of the TPs, so a market equilibrium might not exist under this assumption.
To  x this minor technical issue, we make the following assumption to allow any AP not to use any of the TPs if they all induce negative utilities.
Assumption 5.
There always exists a dummy TP D   M with quality qD =   and price pD = 0.
By Assumption 3, quality qD always induces zero throughput for any AP, and therefore, the dummy TP guarantees a zero utility and can accommodate as many APs as possible in equilibrium.
Effectively, the set ND models the APs that cannot afford to use any TP in the market in reality.
Theorem 4.
For any  xed set N of APs and any set M of TPs with  xed values of pmin , qI and  I for all I   M, there exists a set {pI : I   M} of prices that makes (M, N ) a market equilibrium.
Although TPs might be able to adopt new technologies to improve or differentiate their services, the quality that they can provide is often physically constrained by the nature of the TP, for example, if a TP is a Tier 1 ISP, it cannot guarantee end-to-end delays for the customers unless the access ISP s link is not congested.
Similarly, although TPs might execute a long-term capacity planning, the supply of capacity does not change in a small time scale.
Compared to service quality and capacity, market prices change more frequently and easily.
Theorem 4 says that even in a small timescale where prices adapt to market conditions, prices might still converge to an equilibrium, which re ects the short-term market structure of the Internet ecosystem.
In theory, one might  nd multiple sets of prices that make (M, N ) a market equilibrium.
For example, from any existing equilibrium, one might  nd a TP I such that with only a small change in pI , no APs will change their choices.
This new price also constitutes a market equilibrium.
In practice, these price differences can happen by two reasons.
First, even without a monopoly in a market segment, oligopolistic providers might implicitly collude on the price so that they keep a relatively high price simultaneously.
When one of them starts to reduce price, the price of that segment will converge to a lower price.
Second, the preferences of the APs are quite different so that the price change in one segment might not affect the demand choices of the APs.
De nition 3.
A market equilibrium (M, N ) is competitive if there does not exist any pmin I satisfying QI(cid:0) I (N I < pI with the corresponding N I ),  I(cid:1)   qI .
I   p      If the AP types are very diverse or each market segment consists of many competing providers, one can focus on the above de nition of a competitive market equilibrium.
Technically, a competitive market equilibrium might not exist, since the minimum price might not exist when all the feasible equilibrium prices form an open set.
However, prices in practice have a minimum unit, e.g., one cent, and we can always  nd such a competitive market equilibrium.
Notice that our model is not limited to competitive market equi-libria, i.e., if a segment I is not competitive enough, we can use a higher price for pI .
As a result, competitive equilibrium prices might be biased downward if the real market structure is not perfectly competitive; nevertheless, our qualitative results do not depend on whether the market equilibrium is competitive or not.
Theorem 5.
Let N   = {( i,  i, vi) : i   N } and M  = {(pI , qI ,  I ) : I   M} for some   > 0.
If (M, N ) is a market equilibrium and the quality function QI ( ,  )s are homogenous of degree 0, i.e., QI ( I ,  I ) = QI ( I ,  I ),   > 0, I   M, then (M , N  ) is a market equilibrium too.
Theorem 5 says that if the quality only depends on the ratio of the incoming traf c rate and the capacity, then when the number of APs (and their traf c intensity) and the capacities scale at the same speed, the original market equilibrium prices will remain in equilibrium.
If we consider the queueing delay as the quality metric, because of statistical multiplexing, the average queueing delay reduces when both arrival rate and service rate scales up at the same rate.
In this case, Theorem 5 also implies that each TP I can accept more and more traf c for a  xed delay qI , and as a consequence, the market prices will move downward in a new equilibrium.
We denote  I as the maximum throughput that TP I can accept when it can still ful ll the quality qI , de ned as  I = arg max  I QI ( I ,  I )   qI .
(4)  I For instance, if the quality metric is the average queueing delay under M/G/1 systems and TP I implements a FIFO scheduling policy, by the Pollaczek-Khinchine mean formula, QI(cid:0) I ,  I(cid:1) = E[R], where E[R] denotes the expected residual service  I  I
 time of jobs.
If we want  I to be feasible, we need qI    I    I =  I .
We de ne  I =  I / I as the maximum acceptable throughput per unit capacity, or the conversion factor from raw capacity to achievable throughput.
Notice that given a  xed capacity  I , the smaller delay TP I wants to provide, the smaller maximum amount of traf c it can accept.
For the M/G/1 case,  I tends to 0 when the required quality qI tends to 0, which shows a convex cost structure for the TP.
E[R]+qI  I  I  I qI Based on the monotonicity of QI (Assumption 4), a market equilibrium can be characterized by using  I s as follows.
De nition 4.
A system (M, N ) forms a market equilibrium if for all TP I, 1)  I (NI )    I , and 2) there does not exist p  I   pmin
 I )    I .
with the corresponding N I satisfying  I (NI ) <  I (N     Based on the above alternative de nition of a market equilibrium, we can calculate the competitive equilibrium prices without evaluating QI repeatedly as follows.
Calculate Price Equilibrium(cid:0)N , {pmin

 3. while there exists p  I   [pmin , qI ,  I : I   M}(cid:1) , pI ) such that  I (NI )  

    I (N I )    I set pI = p 


 In the above algorithm, we do not restrict which TP I to choose in step 3 if multiple TPs satisfy the condition.
However, any sequence of updates will make the price vector converge, because
 qC can be considered as the higher and lower tier services of such an IP transit market.
To differentiate the three qualities, we set qA : qB : qC = 1 : 5 : 25.
We vary   from 0 to 1, where the system s total capacity varies from extremely scarce to abundant.
We discretize the AP domain with 50 levels of vi and  i, which forms
 sensitivity follow probability distributions Fv and F  respectively, and  i follows the joint distribution of Fv and F  .
We use the various distributions in Figure 2 for Fv and F  .
For instance, when Figure 2: Common distributions: geometric, uniform, reversed geometric, binomial with p = 0.2, 0.5 and 0.8.
a geometric distribution Geo is used to describe F , it models the scenario where most of the AP traf c are elastic and the amount of quality-sensitive traf c decreases exponentially with its sensitivity level  i.
The binomial distributions BN (p) are often used to approximate a normal distribution of the pro tability vi, or quality sensitivity  i, where p determines the mean value.
In this subsection, we study how the capacities of the TPs affect the equilibrium prices.
We initially set (qA, qB, qC ) = (0.2, 1, 5).
We will evaluate how the quality may impact the equilibrium prices in the next subsection.
each pI will only be decreasing monotonically until convergence.
Similarly, we can also set pI = pmin for all TPs, and the price vector will increase monotonically until convergence.
Based on Theorem 2 and 5, we also have the following result.
Corollary 1.
Let N   = {( i,  3 i,  1vi +  2) : i   N } and M  = {( 1pI +  2, qI / 3,     I ) : I   M} for positive  ,  1,  2,  3 with   If (M, N ) is a market equilibrium, then (M , N  ) is a market equilibrium.
I =  I for all I   M.
Although the prices of the TPs in uence the APs  choices, which further affect the capacity utilization of the TPs, equilibrium prices are the  xed points in which both the APs  choices and the TPs  prices do not change.
However, external factors could move the resulting equilibrium.
In the next section, we will study these fundamental driving forces for the evolution of the Internet economic ecosystem.
By understanding these factors, we will know why the market prices change and why certain evolutions happen.
In this section, we look deeper into the qualitative dynamics of the equilibrium market prices.
In particular, we explore how the different characteristics of the APs and the TPs can affect the market prices in equilibrium.
Each AP i is characterized by three parameters ( i,  i, vi); each TP I is characterized by three parameters (pI , qI ,  I ).
To make a fair comparison between equilibrium prices under different settings, we carefully normalize the system parameters as follows.
We de ne vmax = max{vi : i   N },  max = max{ i : i   N }, and pmin = min{pmin : I   M}.
Based on Theorem 2, we normalize any system (M, N ) by factors  1 = 1/(vmax   pmin),  2 = pmin/(vmax   pmin), and  3 = 1/ max.
As a result, we normalize each  i or vi within the interval [0, 1] and the equilibrium prices will also be scaled accordingly with [0, 1].
If pscaled is the derived market equilibrium price in the normalized system, we can recover the real market price pI as

 pI = (vmax   pmin)pscaled
 + pmin.
When the normalized price pscaled tends to 0, it re ects that the real market price pI goes down to the cost pmin; when pscaled tends to
 AP pro tability vmax.
We describe the TPs  capacity in terms of the maximum acceptable rates  I s. We de ne   = Pi N  i,   = PI M  I and the ratio   =  / .
Based on Corollary 1, any price equilibrium sustains when  is and  I s scale at the same rate.
Thus, we normalize the APs  aggregate maximum traf c intensity   to be 1.
We de ne  I =  I /  as the capacity share of TP I, and under the normalized system, each TP I has  I =  I  .
After the above normalization, we can describe any system by the following four parameters:
 2. the normalized aggregate capacity  , Figure 3: (qA, qB, qC ) = (0.2, 1, 5),  A = 0.05 and  C = 0.25.
in market prices as  B varies: with Shift 3. the distribution of  i over the domain [0, 1]2 of ( i, vi),
 We focus on three different quality types: 1) qA, the highest quality for real-time content delivery, 2) qB, medium quality, mostly for web applications, and 3) qC , the best-effort quality, mostly for elastic traf c.
As analyzed in [25], IP transit markets will be In Figure 3, we  x  A = 0.05,  C = 0.25 and vary  B from
 rium prices when  i follows the joint distributions of (F , Fv) = (U ni, U ni), (Geo, U ni) and (Geo, BN (0.5)) respectively.
We observe that when  B is scarce, equilibrium price pB is close to (but strictly less than) the price pA of its upper class TP.
When  B increases, pB diverges from pA and moves to the price pC of its lower class TP.
When  B becomes abundant, its market price goes
 (qA, qB, qC ) = (0.2, 1, 5) and (F , Fv) = (Geo, U ni).
in market prices as   varies: with Shift Figure 5: (qA, qB, qC ) =  (0.2, 1, 5) where   = 0.2, 1 and 5.
in market prices as   varies: with Shift down to the minimum price after pC .
In general, when the capacity of a particular TP, i.e.,  B, increases, it drives all equilibrium prices down; however, the prices of higher quality TPs, e.g., pA, might not go down to the minimum price.
In the rest of this section, we often use F  = Geo, which models the case where more APs were elastic, and Fv = BN (0.5), which approximates that the AP pro tability follows a normal distribution centered at vi = 0.5.
Note that our qualitative results do not depend on these settings.
In Figure 4, we vary the system capacity   from 0 to 1 along the x-axis.
 i follows the joint distribution (F , Fv) = (Geo, BN (0.5)).
The sub gures show the equilibrium prices when the capacity ratio  A :  B :  C equals 1 : 3 : 5, 1 : 1 : 1 and 5 : 3 : 1 respectively.
In all three cases, when the total capacity   is small, all equilibrium prices are very close and high.
When we increase  , all market prices drop.
By comparing the price curves across the three sub g-ures, we observe that when the capacity share of the higher class TP is smaller (the left sub gure), 1) the three market prices differ more from each other, 2) pC drops faster, and 3) all the prices drop to the minimum price faster than the other two cases.
Because price differences exist in practice, we will use  A :  B :  C = 1 : 3 : 5 in the rest of this section.
Lessons (the TP capacity effects on prices) leaned:   Capacity expansion drives market prices down.
  The capacity expansion of a particular TP I would affect not only its own price pI , but also other TPs  prices, due to the substitution effect of TP I to other TPs.
  When TP I s capacity share  I is small (big), its market price pI is close to the price of its next higher (lower) class TP.
Let us explore how the quality qI of the TPs may affect the equilibrium prices.
We use the setting that the capacity distribution follows  A :  B :  C = 1 : 3 : 5 and  i follows the joint distribution (F , Fv) = (Geo, BN (0.5)).
In Figure 5, we keep the quality ratio qA : qB = qB : qC = 1 : 5 and use (qA, qB, qC ) =  (0.2, 1, 5), where   equals 0.2, 1 and 5 in the three sub gures.
We vary the system capacity   from 0 to 1 along the x-axis.
We observe that when all the TPs improve their quality by the same ratio, i.e.,   = 0.2, the market prices of the TPs are very close; when all the TPs degrade their quality by the same ratio, i.e.,   = 5, the market prices of the TPs diverge greatly.
This observation can be explained by Theorem 3.
When   decreases and all qualities are improved, more APs will choose lower class TPs, which move the prices of the lower class TPs upward and the prices of upper class TPs downward.
As a result, all TPs prices will move closer.
On the other hand, when   increases and all qualities are Figure 6: Shift in market prices as   varies: with qB = 1, qA : qB = qB : qC = 1 :   where   = 2,5,100.
degraded, more APs will choose to upper class TPs, which move the prices of the upper class TPs upward and the prices of lower class TPs downward.
This will further diverge the price differences among the TPs with different qualities.
In Figure 6, we keep qB = 1 and vary the quality ratio qA : qB = qB : qC = 1 :  , where   equals 2, 5 and 10.
We observe that the price differences are positively correlated with the quality ratio.
In particular, when quality ratio is high, e.g.,   = 10, the price of the lowest class TP, i.e., pC, drops earlier and sharper when the total capacity   expands.
At the same time, higher class TPs can still maintain a nonzero market price even after pC drops down the minimum price.
The general trend is that when the quality ratio keeps increasing, the price curves will move higher and toward the left.
In the rest of this section, we will often use the quality ratio
 our qualitative results do not depend on this setting.
Lessons (the TP quality effects on prices) leaned:   The market prices of the TPs would be close to (far from) one another if the quality ratio is small (big) or/and the overall qualities of the market are high (low).
  In reality, the qualities provided by the TPs are becoming better and better, which implies that market prices for different services might converge.
  High-end market segments can still maintain a price difference if they can differentiate their quality from the lower class TPs substantially.
Next, we will see that the TP price differences also depend on the demand side: the characteristics of the APs.
Let us explore how the pro tability distribution Fv may affect the equilibrium prices.
We still keep  A :  B :  C = 1 : 3 : 5 and
 and Fv, where F  is distributed as Geo.
the x-axis.
By doing this, we simulate the cases where the APs become more and more sensitive to quality when the mean sensitivity increases with p.
Figure 7: Shift in market prices as   varies: (qA, qB, qC ) = (0.2,1,5),  A :  B :  C = 1 : 3 : 5, F  = Geo.
Figure 9: Shift of market prices when we vary AP s sensitivity to quality: with  A :  B :  C = 1 : 3 : 5,   = 0.5, (qA, qB, qC ) = (0.2, 1, 5) and F  = BN (p).
Figure 8: Shift in market prices as   varies: (qA, qB, qC ) = (0.2,1,5),  A :  B :  C = 1 : 3 : 5, F  = Geo.
In Figure 7, we vary   from 0 to 1 along the x-axis and plot the equilibrium prices where the pro tability distribution Fv follows a binomial distribution BN (p) parameterized by p = 0.2, 0.5 and 0.8 respectively.
By doing this, we simulate the normal distributions of the APs  wealth varying the mean value from small to large.
We observe that despite the difference in mean pro t of the APs, pC drops to the minimum price at the same time.
The price curves in all cases keep the same shape; however, they scale differently on the vertical axis.
This indicates that the market prices depend on how much the APs are able to pay for the services, and how they demand for the TPs based on their values of ( i, vi).
In Figure 8, we vary Fv to be Geo, U ni and ReGeo.
We observe that the shapes of the price curves are very different: prices decrease convexly, linearly and concavely in the three sub gures.
In general, how fast the prices drop depends on the density of the APs whose pro tability are around that price range, and the shape of the curves look like the complimentary cumulative distribution function (CCDF) of Fv.
Lessons (the AP wealth effects on prices) leaned:   The market prices of the TPs are positively correlated with the mean pro tability of the APs.
  At a certain price range where the density of the APs is high (low), more (less) competition among the APs drives the prices close to (far below) their pro tability.
In this subsection, we study how the quality sensitivity distribution F  affects the equilibrium prices.
We set  A :  B :  C =
 nomial distribution BN (p), where we vary the parameter p along Figure 10: Shift of market prices when we vary AP s sensitivity to quality: with  A :  B :  C = 1 : 3 : 5,   = 0.5, Fv = BN (0.5) and F  = BN (p).
In Figure 9, we  x (qA, qB, qC ) = (0.2, 1, 5) and vary Fv to be U ni, BN (0.5) and Geo in the three sub gures.
We observe that although the pro tability distribution affect the absolute price values, the shape of the price curves look similar.
When the quality sensitivity of the APs increases, the lowest quality service price, i.e., pC, drops sharply and quickly.
Although pA and pB drops accordingly with pC, after pC reaches the minimum price, both pA and pB rebound.
With further increase in quality sensitivity, pB shows a trend to decrease slowly; however, pA always stays at a high level.
When the APs become more sensitive to quality, more and more APs start to move to higher class TPs.
As a result, the capacity  C becomes underutilized, which also drives pC down very quickly.
Although pC s drop pulls down the overall market prices, more APs move to higher class TPs, which make TPs A and B in demand, and therefore, keep pA and pB steadier.
After pC reaches the minimum price, pC stops decreasing.
As the APs  quality sensitivity keeps increasing, even the minimum market price of pC becomes relatively expensive to the APs.
This makes even more APs move to TP A and B and drives pA and pB upward.
In Figure 10, we  x Fv = BN (0.5) and vary the qualities to be (qA, qB, qC ) =  (0.2, 1, 5), where   = 0.5, 1 and 2.
We observe the same trends as in Figure 9 that pC drops quickly and sharply to the minimum price as the APs  quality sensitivity increases.
As   increases, all the price curves move to the left and the price drop of lower class TPs becomes quicker and sharper.
This also coincides with the observations made in Figure 5 that when the qualities degrade, the price of the lower class TP drops much quicker.
In the above illustrations, we vary the distribution F  .
It is also i =  i for some possible that all the APs  sensitivity increase by  
 the APs keep their quality sensitivity constant and all the qualities become poorer.
By Theorem 3 and the TP quality effect result in Figure 5, we also conclude that more APs will prefer higher quality TPs and the price of the lower quality TPs will drop sharply.
Lessons (the AP quality-sensitivity effects on prices) leaned:
 area networks toward users?
Mostly because the APs become more sensitive to service quality, they cannot rely on the transit providers to deliver content.
As high quality services are limited and access ISPs would obtain more pricing power, large APs might consider establishing their own networks toward users as a cheaper alternative than paying access ISPs for better services in the future.
  When the APs become more sensitive to the service quality, the price of lower class TPs will drop quickly.
  When the price of the lowest quality TP goes down to its cost, the prices of higher quality TPs might increase due to their relatively cheap prices and high demand.
By understanding the factors that drive the market equilibrium, we reason about the evolution of the Internet ecosystem and reach plausible answers to the questions raised in Section 1.
We do not claim that our answers below are exhaustive and the limitations of our model will be discussed in Section 5.4.
effect tells that the price drop can be a consequence of the capacity expansion of the transit providers.
Compared to the capacities at the last-miles, the capacity in the backbone grows faster than demand and is abundant [14].
Also, the price drop in better quality services, i.e., CDN prices, will drive the transit prices further down.
The quality effect tells that when the transit quality differs a lot from the CDN services, the prices will diverge greatly.
The wealth effect tells that since the majority of the elastic APs might not be very pro table, transit providers cannot fully utilize its capacity and charge a high price at the same time.
This is also why they are looking for providing value-added and differentiated services.
Last, the AP quality-sensitivity effect tells that when AP traf c becomes more and more inelastic, e.g., the surge of Net ix traf c, lower quality service will become less valuable and therefore its price will drop quickly.
effect tells that when the capacity of higher quality service is small, it can maintain a price difference with the lower quality services.
The quality effect tells that if a CDN service s quality differs a lot from the transit services, it can be priced much higher.
When the capacity of the transit market was limited and priced high, the demand for even higher quality service drove the price for potential CDN services even higher.
This explains why CDNs emerged in the  rst place.
The wealth effect tells that when the APs  pro tabil-ity is not high, the market prices cannot be high.
However, due to the low cost structure of the CDNs, they can still help small APs who could not afford the infrastructure to support large demand.
The AP quality-sensitivity effect further tells that with the traf c being more and more sensitive to quality, the price of high quality CDN can sustain at a high level.
can be partially explained by the AP quality-sensitivity effect and the TP quality effect.
When the AP traf c becomes more and more sensitive to service quality, they are more willing to pay for the higher quality services.
Because access ISPs are physically closer to the users, their service quality is naturally much better than other providers who have to go through the access ISPs to reach the end-users anyways.
Consequently, the difference in service quality makes it possible for the access ISPs to charge services at higher prices.
Furthermore, Comcast s monopolistic position in the U.S.
market could be another reason, under which its price will be set higher than the competitive market price under De nition 3.
Besides understanding how each isolated factor might affect the market prices, we incorporate ground truth data [10, 19, 4, 11], e.g., the historical trends of the TPs  capacity expansion and the APs  characteristics, and project possible future price dynamics of the Internet ecosystem.
Through this, our model can help the TPs make various long-term business decisions.
Let us demonstrate this.
We take a macroscopic view and categorize network services as two types: M = {A, B}.
B models the IP transit service that provides interconnection based on  best-effort ; A models the CDN or private peering type of service that provides better service quality than B.
We categorize the APs as three types: N = {a, b, c}.
a models the video or realtime interactive applications that are very sensitive to quality.
b models the web applications that are elastic but more tolerate to quality than type a applications.
c models the inelastic applications, e.g., email and P2P  le download.
By Corollary 1, we know that when quality and the sensitivity parameters scale inversely, the equilibrium remains the same; therefore, without loss of generality, we set qB = 1 as the baseline best-effort quality level.
We set the quality sensitivity parameters to be ( a,  b,  c) = (10, 1, 0.1).
Under this setting, type a APs would only obtain e 10   4.5 5 of their maximum throughput under qB, which implies that the best-effort service cannot support quality sensitive applications.
Also, under qB, a type b AP could get e 1   37% of its maximum throughput; however, a type c AP could get e 0.1   90% of its maximum throughput.
When measured by delay, the quality of service for realtime applications often require the delay to be at the order of milliseconds [27], compared to the best-effort service delays at the order of seconds.
Thus, we choose qA = 0.01 to re ect the same order of magnitude of service difference.
As a result, even type a APs would obtain e 0.1   90% of their maximum throughput under the better quality level qA.
Next, we try to estimate the capacity of the TPs on the Internet.
We take the Equinix Internet Exchange at New York (Equinix-NY) as a reference market and estimate the capacities based on the data provided by PeeringDB [10].
At the end of year 2011, there were
 among which 44 use Open peering policy and the remaining 58 use either Selective or Restricted peering policy.
The total capacity was around 21 Tbps, among which the ISPs using Open peering policy contributed 7 Tbps and the remaining ISPs contributed 14 Tbps.
Since Selective and Restricted policies are used for private and often paid-peering agreements, we set  A and  B to be 14 and
 From the Global Internet Geography [4] report, between 2007 to 2011, the international Internet capacity increased sixfold and the bandwidth to the U.S. had increased nearly 50 percent per year.
To a  rst approximation, we assume that the capacity   of the TPs increases 50% per year.
We de ne   =  a +  b +  c and  a,  b and  c as the weight of the throughput upper bound of each application type.
Given   and the weight of AP i, we obtain  i as  i =  i  a +  b +  c  ,   i = a, b, c.
[19], we set ( a,  b,  c) = (2%, 75%, 23%) for the year 2007, and assume that the weight for video ( a), web ( b) and inelastic applications ( c) increase at an annual growth rate of 150%, 50% and 20% respectively.
Notice that IP transit prices are often quoted for per Mbps-month, while CDN prices are often quoted for per terabit.
If capacity is fully utilized 24/7, $1 per Mbps-month can be translated into $0.386 per terabit.
We assume that the maximum per unit traf c revenue for the APs is $10 Mbps-month and the APs  revenue are uniformly distributed.
We use our macroscopic model to  t the historical prices starting from 2007 and project future Internet prices.
In a  rst approximation, we choose the following parameters.
2.   increases at an annual growth rate r  = 22%.
might be less competitive and could charge a much higher price; therefore, when the industry becomes more competitive, we expect to see much sharper price drops.
Based on the trend from 2007 to 2011, our model projects that both the IP transit and CDN prices will further drop, at an even faster rate, and IP transit price will drop to its minimum price.
Of course, this projection is based on the assumption that the capacity of the TPs will keep expanding at the 50% annual rate.
We will further discuss potential trends of future prices in a later subsection.
In this subsection, we show the sensitivity of our price projection with respect to the chosen parameters.
Figure 12: Sensitivity to initial demand  07 and rate r .
First, we want to see how the demand parameter   affects the price dynamics.
Figure 12 shows a projection of service prices when the initial value  07 and the growth rate r  change.
In the left sub gure, we vary  07 to be 9 and 11 Tbps compared to the benchmark value of 10 Tbps.
We observe that the prices are positively correlated with  07.
In the right sub gure, we vary the growth rate r  to be 20% and 24% compared to the benchmark value of 22%.
We observe that the prices again are positively correlated with r .
Both tells that when the demand increases, so do the prices.
Figure 13: Sensitivity to capacity utilization  A and  B .
Second, we want to see how the capacity utilization factor  I =  I / I affects the price dynamics.
Figure 13 shows a projection of Internet service prices when  A and  B vary from the benchmark.
In the left sub gure, we vary  A to be 0.2 and 0.4 compared to the benchmark value 0.3.
In the right sub gure, we vary  B to be
 the all prices are negatively correlated with the capacity utilization factors.
Also, the IP transit prices are sensitive to both  A and  B; while the CDN prices are only sensitive to its utilization factor  A.
Figure 11: Historical price and future price projection.
In Figure 11, the upper left sub gure plots the achievable throughput for the CDN ( A) and IP transit ( B) services from 2007 to 2014 and the lower left sub gure plots the maximum demand  a,  b and  c for the same time period.
The upper right sub gure plots the price dynamics of both IP transit and CDN services and the lower right sub gure plots the percentage of price change for both services.
We observe that average price drop from 2007 to 2011 is approximately 20%, which coincides with the price drop surveyed in the Global Internet Geography [4] report.
Also, the price of IP transit is below $2 per Mbps-month, very close to the mean of IP transit prices, where the lowest price fell to $1 per Mbps-month.
Compared to the video delivery pricing [11], our price projection shows that the CDN price drops around 8% annually from
 terabit.
This price is lower than the $7.5 per terabit price for APs with volume of 5PB data and the price drop is slower than the observed 20% price drop in the CDN industry [11].
The difference could come for two reasons: 1) since CDN service charges based on traf c volume, we cannot assume that the APs would always use the capacity 24/7, and therefore, the CDN providers should charge some premium on top of the basic per Mbps per month charge, 2) in contrast to our competitive model for CDN service, the industry
 Now, we demonstrate that by using the price projection from our model, we can help the TPs to make business decisions on 1) how aggressive the TPs should expend their capacity, and 2) whether the TPs should/would tend towards Open or Selective peering policies.
Figure 14: Price projection under various capacity ratios  A :  B and capacity expansion rate r  .
To answer the  rst question, we vary the capacity growth rate of the TPs r  to be 40% and 60%, compared to the historical benchmark rate 50% and plot the price projections in the left sub gure of Figure 14.
We observe that when the capacity grows at 60% per year, both the CDN and IP transit price drop fast and the IP transit price will down to its cost next year; however, when the growth rate is 40%, the IP transit price will be decreasing at a very slow rate.
These observations tell us that the ISPs providing IP transit services might want to slow down their investment in capacity expansion; however, CDN providers and ISPs that sell private-peering and QoS might want to continue to expand their capacity when their pro t margins are still above zero.
As the price of IP transit drops, we believe that the investment in the transit capacity will slow down, which will also stabilize the price of the IP transit services.
To answer the second question, we vary the capacity ratio  A :  B from the benchmark ratio 2 : 1 (14 Tpbs : 7 Tbps) to 3 : 1 and
 model the scenarios where ISPs will tend to be more Selective and more Open in their peering policies respectively.
We observe that if more ISPs are going to use an Open peering policy, the IP transit price will drop to its cost quickly; otherwise, the IP transit price will get closer to the CDN price and be stable.
This observation implies that ISPs would have strong incentives to move towards Selective peering policies if possible, which coincides with the reality that the access ISP, Comcast, started to use private peering exclusively.
In summary, we predict that although the CDN price will still be dropping, the price of IP transit will be more stable.
Furthermore, the capacity expansion will slow down and more ISPs will tend to use Selective rather than Open peering policies in the near future.
First of all, our general equilibrium model implicitly assumes that each market segment is competitive.
In practice, some market segment could be lack of competition and form a monopolistic or oligopolistic market structure.
Thus, the real market prices will be higher than what our model predicts.
Second, our equilibrium model does not capture the off-equilibrium and transit dynamics that could happen in practice.
Third, our model is in nature macroscopic, and it does not capture detailed information like peering agreement, topology, traf c patterns and etc.
Nevertheless, our model does capture the type of different services the TPs provide via implicitly encoding all the relevant information into the quality level qI .
From the APs  point of view, they do care about quality rather than other details of the TPs.
Fourth, since our focus is on the transit/CDN market, our model does not intend to capture the end-user market aspects.
For example, modeling the bundle of access services and other service differentiations are out of scope.
Last but not the least, our macroscopic model provides some qualitative reasons for the Internet evolution, which we do not claim to be exhaustive.
There might be additional factors/reasons that are not captured by our model, e.g., the lack of competition in the market.
Many empirical studies have been tracking the evolution of the Internet using measurements and public data sets [19, 15, 17, 24,
 2007 and 2009, and observed the changes in traf c patterns as well as the consolidation and disintermediation of the Internet core.
Gill et al.
[17] collected and analyzed traceroute measurements and showed that large content providers are deploying their own wide-area networks.
Dhamdhere et al. [15] con rmed the consolidation of the core of the Internet, that brings the content closer to users.
Akella et al. [12] used measurements to identify and characterize non-access bottleneck links in terms of their location, latency and available capacity.
At the edge of the Internet, Sundaresan et al.
[24] studied the network access link performance measured directly from home gateway devices.
We focus on a macroscopic model of the Internet ecosystem that captures the application traf c going through the network transport service providers.
Many works [13, 16, 21, 22, 25, 20, 18] focused on the modeling perspective of the Internet evolution.
Chang et al. [13] presents an evolutionary model for the AS topologies.
Lodhi et al. [20] used an agent-based model to study the network formation of the Internet.
Motiwala et al. [22] used a cost model to study the Internet traf c.
Valancius et al. combined models and data to study the pricing [25] structure of the IP transit market.
Faratin et al. [16] and Ma et al.
In this work, we take a holistic view and analyze the business decisions and evolutions of the APs and TPs altogether.
[21] studied the evolution of the ISP settlements.
We proposed a network aware, macroscopic model to explain the evolution of the Internet.
Our model captures 1) the business decisions of the APs, 2) the pricing and competition of the TPs, and
 ing how the AP characteristics (i.e., traf c intensity, pro tability and sensitivity to quality), and the TP characteristics (i.e., quality, price and capacity, affect the market equilibrium), we obtain fundamental understanding of why historical and recent evolutions of the Internet have happened.
With further estimations of the trends in traf c demand, capacity growth and quality improvements, our model can also project the future evolution of the Internet ecosystem.
This model provides a tool for the Internet players to better understand their business and risks, and help them to deal with their business decisions in the complicated and evolving ecosystem.
Acknowledgement This study is supported by the Human Sixth Sense Programme at the Advanced Digital Sciences Center from Singapore s Agency for Science, Technology and Research (A*STAR), Ministry of Education of Singapore AcRF grant R-252-000-448-133, and the National Science Foundation grants CNS-1017934 and CCF-1139915.
