Online search for products is increasing in popularity, as more and more users search and purchase products from the Internet.
Most search engines for products today are based on models of relevance from  classic  information retrieval theory [22] or use variants of faceted search [27] to facilitate browsing.
However, the decision mechanism that underlies the process of buying   This work was supported by NSF grants IIS-0643847 and IIS-0643846.
Copyright is held by the International World Wide Web Conference Committee (IW3C2).
Distribution of these papers is limited to classroom use, and personal use by others.
a product is di erent from the process of  nding a relevant document or object.
Customers do not simply seek to  nd something relevant to their search, but also try to identify the  best  deal that satis es their speci c desired criteria.
Of course, it is di cult to quantify the notion of  best  product without trying to understand what the users are optimizing.
Today s product search engines provide only rudimentary ranking facilities for search results, typically using a single ranking criterion such as name, price, best selling (volume of sales), or more recently, using customer review ratings.
This approach has quite a few shortcomings.
First, it ignores the multidimensional preferences of consumers.
Second, it fails to leverage the information generated by the online communities, going beyond simple numerical ratings.
Third, it hardly accounts for the heterogeneity of consumers.
These drawbacks highly necessitate a recommendation strategy for products that can better model consumers  underlying behavior, to capture their multidimensional preferences and heterogeneous tastes.
Recommender systems [1] could  x some of these problems but, to the best of our knowledge, existing techniques still have limitations.
First, most recommendation mechanisms require consumers  to log into the system.
However, in reality many consumers browse only anonymously.
Due to the lack of any meaningful, personalized recommendations, consumers do not feel compelled to login before purchasing.
For example, on Travelocity, less than 2% of the users login.
But even when they login, before or after a purchase, consumers are reluctant to give their individual demographic information due to a variety of reasons (e.g., time constraints or privacy issues).
Therefore, most context information is missing at the individual consumer level.
Second, for goods with a low purchase frequency for an individual consumer, such as hotels, cars, real estate, or even electronics, there are few repeated purchases we could leverage towards building a predictive model (i.e., models based on collaborative  ltering).
Third, and potentially more importantly, as privacy issues become increasingly important, marketers may not be able to observe the individual-level purchase history of each consumer (or consumer segment).
In contrast, aggregate purchase statistics (e.g., market share) are easier to obtain.
As a consequence, many algorithms that rely on knowing individual-level behavior lack the ability of deriving consumer preferences from such aggregate data.
Alternative techniques try to identify the  Pareto optimal  set of results [3].
Unfortunately, the feasibility of this approach diminishes as the number of product characteristics increases.
With more than  ve or six characteristics, the probability of a point being classi ed as  Pareto optimal  dramatically increases.
As a consequence, the set of Pareto optimal results soon includes every product.
So, how to generate the  best  ranking of products when fundamental concepts from economics: utility and surplus.
Utility is de ned as a measure of the relative satisfaction from, or desirability of, consumption of various goods and services [17].
Each product provides consumers with an overall utility, which can be represented as the aggregation of weighted utilities of individual product characteristics.
At the same time, the action of purchasing deprives the customer from the utility of the money that is spent for buying the product.
With the assumption consumers rationality, the decision-making process behind purchasing can be viewed as a process of utility maximization that takes into consideration both product quality and price.
Based on utility theory, we propose to design a new ranking system that uses demand-estimation approaches from economics to generate the weights that consumers implicitly assign to each individual product characteristic.
An important characteristic of this approach is that it does not require purchasing information for individual customers but rather relies on aggregate demand data.
Based on the estimated weights, we then derive the surplus for each product, which represents how much extra utility one can obtain by purchasing a product.
Finally, we rank all the products according to their surplus.
We extend our ranking strategy to a personalized level, based on the distribution of consumers  demographics.
We instantiate our research by building a search engine for hotels, based on a unique data set containing transactions from Nov. 2008 to Jan. 2009 for US hotels from a major travel web site.
Our extensive user studies, using more than 15000 user evaluations, demonstrate an overwhelming preference for the ranking generated by our techniques, compared to a large number of existing strong baselines.
The major contributions of our research are the following:   We aim at making recommendations based on better understanding of the underlying  causality  of consumers  purchase decisions.
We present a user model that captures the decision-making process of consumers, leading to a better understanding of consumer preferences.
This is in contrast to building a  black-box  style predictive model using machine learning algorithms.
The causal model relaxes the assumption of a  consistent environment  across training and testing data sets and allows for changes in the modeling environment and predicts what should happen even when things change.
  We infer personal preferences from aggregate data, in a privacy-preserving manner.
Our algorithm learns consumer preferences based on the largely anonymous, publicly observed distributions of consumer demographics as well as the observed aggregate-level purchases (i.e., anonymous purchases and market shares in NYC and LA), not by learning from the identi ed behavior or demographics of each individual.
  We propose a ranking method using the notion of surplus, which is not only theory-driven but also generates systematically better results than current approaches.
  We present an extensive experimental study: using six hotel markets, 15000 user evaluations, and using blind tests, we demonstrate that the generated rankings are signi cantly better than existing approaches.
The rest of the paper is organized as follows.
Section 2 gives the background.
Section 3 explains how we estimate the model parameters, speci cally how we compute the weights associated with product characteristics.
Section 4 discusses how we build our basic rankings, and how we can personalize the presented results.
Section 5 provides the setting for the experimental evaluation, and Section 6 discusses the results.
Finally, Section 7 discusses related work and Section 8 concludes.
In this section, we provide the background economic theory that explains the basic concepts behind our model.
We start by formalizing our problem and introducing the  economic view  of consumer rational choices.
For better understanding, we introduce the following theoretical bases: utility theory, characteristics-based theory, and surplus.
In general, our main goal is to identify the best products for a consumer.
The example illustrates this: Example 1.
Alice is looking for a hotel in New York City.
She prefers a place of good quality but preferably costing not more than $300 per night.
She conducts a faceted search (e.g., with respect to price and ratings): Unfortunately, with explicit price constrain, she may miss some  great deal  with much higher value but a slightly higher price.
For instance, the 5-star Mandarin hotel happens to run a promotion that week with a discounted price of $333 per night.
With the most luxurious environment and room services, the price for Mandarin would normally be around $900 per night otherwise.
So, although the price is $33 above her budget, Alice would certainly be willing to  grab the deal  if this hotel appeared in the search result.
However, the problem is how can Alice know that such a deal exists?
In other words, how can we improve the search so that it can help Alice identify the  best value  products?
To examine this problem, we introduce the concept of surplus from economics.
It is a measure of the bene ts consumers derive from the exchange of goods [17].
If we can derive the surplus from each product, then by ranking the products according to their surplus, we can easily  nd the best product that provides the highest bene ts to a consumer.
Now the question is, how to derive the surplus so that we can quantify the gain from buying a product?
To do so, we introduce another concept: utility.
Surplus can be derived from utility and rational choice theories.
A fundamental notion in utility theory is that each consumer is endowed with an associated utility function U , which is  a measure of the satisfaction from consumption of various goods and services  [17].
The rationality assumption de nes that each person tries to maximize its own utility.1 In the context of purchasing decisions, we assume that the consumer has access to a set of products, each product having a price.
Informally, buying a product involves the exchange of money for a product.
Therefore, to analyze the purchasing behavior we need two components for the utility function:   Utility of Product: The utility that the consumer will gain   Utility of Money: The utility that the consumer will lose by buying the product, and by paying the price for that product.
In general, a consumer buys the product that maximizes utility, and does so only if the utility gained by purchasing the product is higher than the corresponding, lost, utility of the money.
More formally, assume that the consumer has a choice across n products, and each product Xj has a price pj.2 Before the purchase, the consumer has some disposable income I that
 While in reality consumers are not always rational, it is a convenient modeling framework that we adopt in this paper.
As we demonstrate in the experimental evaluation, even imperfect theories generate good experimental results.
To allow for the possibility of not buying anything, we also add a dummy product X0 with price p0 = 0, which corresponds to the choice of not buying anything.
Xj generates a product utility Up(Xj) and, simultaneously, paying the price pj decreases the money utility to Um(I   pj).
Assuming that the consumer strives to optimize its own utility, the purchased product Xj is the one that gives the highest increase in utility.
This approach naturally generates a ranking order for the products: The products that generate the highest increase in utility should be ranked on top.
Thus, to compute the increase in utility, we need the gained utility of product Up(Xj) and the lost utility of money Um(I)   Um(I   pj).
Modeling the utility of a product can be traced back to Lancaster s characteristics theory [15] and Rosen s hedonic price model [24].
The hedonic price model assumes that di erenti-ated products are described by vectors of objectively measured characteristics.
In addition, the utility that a consumer has for a product can be decomposed into a set of utilities for each product characteristic.
According to this model, a product X with K features can be represented by a K-dimensional vector X = (cid:2)x1, .
.
.
, xK(cid:3), where xk represents the amount or quality of the k-th characteristic of the product.
The overall utility of product X is then modeled by the function Up(x1, ..., xK ).
One of the critical issues in this model is how to estimate the aggregated utility from the individual product characteristics.
Based on the hedonic price model, we assume that each product characteristic is associated with a weight representing consumers  desirability towards that characteristic.
Under this assumption, we further re ne the de nition of overall utility to be the aggregation of weighted utilities from the observed individual characteristics and an unobserved characteristic  : Up(X) = Up(x1, .
.
.
, xK ) =  k   xk +  , (1) k=1 where  k represents the corresponding weight that the consumer assign to the k-th characteristic xk.
Notice that with   we capture the in uence of all product characteristics that are not explicitly accounted in our model.
So, a product that consumers perceive as high-quality due to a characteristic not explicitly captured in our measurements (e.g.
brand name), will end up having a high value of  .
Given the utility of a product, to analyze consumers  motivation to trade money for the product, it is also necessary to understand the utility of money.
This concept is de ned as consumers  happiness for owning monetary capital.
Based on Alfred Marshall s well-established principles [17], utility of money has two basic properties: increasing and concave.
  Increasing: An increase in the amount of money will cause an increase in the utility of money.
In other words, the more money someone has, the better.
  Concave: The increase in utility, or marginal utility of money, is diminishing as the amount of money increases.
Based on these properties, an example of the utility function for money is shown in Figure 1.
Note that with the concave form of the utility function, the slope is decreasing hence the marginal utility of money is diminishing.
So, $100 is more important for someone with $1000 than for someone with $100,000.
This also implies that consumers are risk-averse under normal circumstances.
This is because with the same probability to win or lose, losingN dollars in the assets will cause a drop in the utility larger than the boost while winning N dollars.
K(cid:2) Figure 1: A concave, bounded, increasing function for  1utility of money,  approximated with a linear function for small changes  The concave assumption can be relaxed when the changes in money are small.
For most transactions, we often assume that the marginal utility of money is approximately constant.
More formally, we assume that a consumer with income I receives a money utility Um(I).
Paying the price p decreases the money utility to Um(I   p).
Assuming that p is relatively small compared to the disposable income I, the marginal utility of money remains mostly constant in the interval [I   p, I] [17].
Under this assumption, the utility of money that the consumer will lose by paying the price p for product X, can be thereby represented in a quasi-linear form as follows: Um(I)   Um(I   p) =     I       (I   p) =  (I)   p, (2) where  (I) denotes the marginal utility for money for someone with disposable income I.
Given the utility of product and utility of money, we can now derive the utility surplus as the increase in utility, or excess utility, after the purchase.
More formally, the mathematical de nition for utility surplus is provided as follows.
Definition 1.: The utility surplus (U S), for a consumer with disposable income I, when buying a product X priced at p, is thegain in the utility of product Up minus the loss in the utility of money Um.
U S = Up(X)   [Um(I)   Um(I   p)] +  i + +     = j     p(cid:3)(cid:4)(cid:5)(cid:6)  k   xk (cid:4)(cid:5) (cid:6) (cid:2) (cid:3) k Utility of money Stochastic error  (cid:3)(cid:4)(cid:5)(cid:6) (3) Utility of product Note that   is a product-speci c disturbance scalar summarizing unobserved characteristics of product X, and  is a stochastic error term that is assumed to be i.i.d.
across products and consumers in the selection process and is usually assumed to follow a Type I extreme-value distribution.
2 In this theory model, the key challenge is to estimate the corresponding weights assigned by consumers towards money and product dimensions.
We discuss this next.
In the previous section, we have introduced the background of utility theory, characteristics-based theory, and surplus.
Recall that our main goal is to identify the best product (with the highest surplus) for a consumer.
This is complicated by the fact that utility, and therefore surplus, of consumers is private observed utility  that we can compare with our  model predicted utility.  Instead we need to observe the behavior of consumers and estimate the values of these latent parameters that explain best the consumer behavior.
Furthermore, since we cannot assume that we can observe in detail the behavior of individual consumers, nor can we explicitly ask each consumer for their personal  tastes  (e.g., choice of a product,  weight  assigned to a product feature, etc.
), we need to extract utilities and derive individual preferences by using aggregate data.
The basic idea is the following: If we know the utilities of di erent products for a consumer, we can estimate the demand for di erent products, as consumers will behave according to their utility-encoded preferences.
So, if we observe the demand for various products, we can infer the preferences of the consumer population for di erent product aspects.
Observing product demand is easier than it sounds: For example, we can observe salesrank on Amazon.com and transform salesrank to demand [8], or we can directly observe the transactions at marketplaces such as eBay and Amazon [11], or we can simply get directly anonymous transactions from a merchant.
In this section, we discuss how we estimate the parameters using aggregate demand data.
First, in Section 3.1 we discuss the simpler case where consumers are homogeneous and have similar preferences.
Then in Section 3.2 we analyze the more realistic case where consumers have di erent preferences, which depend on their demographics and purchase context.
The basic Logit model, introduced by McFadden [18, 19], assumes that consumers have  homogeneous preferences  towards product characteristics.
In other words, the weights   and   are common across all consumers.
Thus, following De nition 1, the utility surplus for consumer i and product j is written as: j = Vj( ,  ) +  i j.
U Si k  k   xk (4) j +  j       pj.
Notice that we where Vj( ,  ) = separate preferences towards product j, captured by Vj( ,  ), from non-deterministic aspects of individual consumer behavior, captured by the error term  i j.
According to the assumption of consumer rationality for utility maximization, the consumer chooses the product that maximizes utility surplus.
Note that the choice is stochastic, given the error term  i j.
Therefore, in our scenario, the probability that a consumer i chooses product j is: (cid:7) P (choicei j) =P (U Si j > U Si l ) ( l in the same market, l (cid:5)= j) .
Solving this equation, we have [18, 19]: (cid:7) P (choicei j) =
 exp (Vj( ,  )) l exp (Vl( ,  )) .
(5) (6) In the homogeneous case, all consumers have the same   and   and this probability is proportional to the market share3 of project j (the consumer-speci c error term  i j has disappeared).
Notice that the problem of estimating preferences can be now expressed as a logistic regression problem.
What is worthwhile to mention is that this solution is not an adhoc choice, but is a direct derivation from a theory-driven user behavior model.
Daniel McFadden got the Nobel prize in Economics in 2000
 Market share is de ned as the percentage of total sales volume in a market captured by a brand, product, or  rm.
for establishing the connection between logistic regression and models of discrete user choice.
Given Equation 6, we can estimate consumer preferences (expressed by the parameters   and  ), by observing market shares of the di erent products.
One challenge is that we need to know the  demand  for the  buy nothing  option in order to estimate properly the value P (choicej) in Equation 6.
Speci cally, we set P (choicej) = dobs is the observed demand for product j and dtotal is  total demand,  which includes the demand for the buy-nothing option.4 Taking logs in Equation 6 and solving the system [5]: j /dtotal , where dobs j ln(dobs j ) =     pj +  k   xk j +  j.
(7) (cid:2) k Such a model can be easily solved to acquire the parameters   and   using any linear regression method, such as ordinary least squares (OLS).
Example 2.
Assume that we have a hotel market in New York, with two hotels: Hotel M (Mandarin Oriental, 5-star), and Hotel D (Doubletree, 3-star).
From day 1 to 3, we observe that the price for Mandarin Oriental is $500, $480 and $530 per night.
We also observe a corresponding demand of 400, 470, and
 is $250, $270 and $225 per night, and its corresponding demand is 600, 530 and 680 bookings.
Using our model, we can write down the regression equations: ln(bookings) =     price +     stars + fhotel +  (8) Here, we divide the unobservable   into a  xed e ectf that is common for the same hotel (e ectively a dummy binary variable), and an i.i.d.
random error term .
Using OLS, we get   = 0.0067 and   = 0.64 which express the sensitivity of the consumers to price and their preference for  stars,  respectively.
Of course, the assumption of homogeneity of consumer preferences is only an ideal case.
In reality, consumers are di erent and their tastes vary.
Next, we examine the case where the consumer have heterogeneous tastes.
In reality, consumers  preferences are heterogeneous.
In principle, we could observe a customer for a long period of time and then use the Logit scheme described above to extract the preferences of each customer.
Unfortunately, we can rarely observe individual behavior over long periods of time, so it is di cult to estimate the individual preferences for each consumer.
To allow preferences to vary, though, we can assume that preferences are a function of consumer demographics and purchase context.
For example, everything else being equal, honeymooners may appreciate a hotel in a romantic remote setting, while business travelers may appreciate more a location with easy access to public transportation.
We can therefore characterize each customer by a set of demographic characteristics (e.g., age, gender, travel purpose, etc.)
and make the preference coe cients   to be a function of these demographics.
In this case, the overall preference distribution of the whole population is a mixture of preference distribution of the various consumer types in the population.
The main challenge in this setting is that we only observe overall demand, and not the demand from each separate consumer group.
So, the question
 Since dtotal , appears as a constant in across all equations, the absolute value of dtotal and of the  buy nothing  demand d0 is not relevant to the the parameter estimation and can be ignored.
types by simply observing the aggregate product demand?
We solve this issue by monitoring demand for similar products in di erent markets, for which we know the distribution of consumers.
Since the same product will have the same demand from a given demographic group, any di erences in demand across markets can be attributed to the di erent demographics.
The following simpli ed example illustrates the intuition behind this approach.
Example 3.
Consider an example where we have two cities, A and B and two types of consumers: business trip travelers and family trip travelers.
City A is a business destination with 80% of the travelers being business travelers and 20% families.
City B is mainly a family destination with 10% business travelers and 90% family travelers.
In city A, we have two hotels: Hilton (A1) and Doubletree (A2).
In city B, we have again two hotels: Hilton (B1) and Doubletree (B2).
Hilton hotels (A1, B1) have a conference center but no pool, and Doubletree hotels (A2, B2) have a pool but no conference center.
To keep the example simple, we assume that preferences of consumers do not change when they travel in di erent cities and that prices are the same.
By observing demand, we see that demand in city A (business destination) is 820 bookings per day for Hilton and 120 bookings for Doubletree.
In city B (family destination) the demand is
 tree.
Since the hotels are identical in the two cities, the changes in demand must be the result of di erent traveler demographics, hinting that a conference center is desirable for business travelers.
For this paper, to extract consumer preferences, we use the Random-Coe cient Model [6], introduced by Berry, Levinsohn, and Pakes, and commonly referred to as the BLP model.
This model extends the basic Logit model by assuming the coe cients   and   in Equation 6 to bedemographic-speci c .
Let T i be a vector representing consumer type, which can specify a particular purchase context, age group, and so on.
In the simplest case, we can have a binary variable for each consumer group.
With the preferences being now demographic-speci c, we write the utility surplus for consumer i, of type T i, when buying product (cid:2) j, with features (cid:2)x1 j(cid:3), at price pj to be: )   xk j    (I i )   pj +  j +  i j.
j , .
.
.
, xk U Si (T i j = (9)  k k (cid:9) (cid:8) For the Logit model, in Equation 4, we used V ( ,  ) to stylistically separate the population preferences from the idiosyncratic behavior of the consumer.
We now do the same for the BLP model, separating the mean population preferences from the demographic-speci c preferences.
So, we write  k(T i) =  k +  k , where  k is the mean of the preference distribu-T T i tion, and  k T is a vector capturing the variation in the preferences from di erent consumer types.
Similarly, we model  i as a function of income I i:  (I i) = .
Notice that we assume  I and  T to be independent.
We rewrite U Si   +  I I i j as: (cid:8) (cid:9) U Si j =  k +  k T T i j +  j   (cid:5)   xk   +  I I i (cid:6)   pj +  i j .
(10) (cid:2) (cid:3) k We use  j =       pj + j +  j to represent the mean utility of product j.
Then, as in the Logit model, we derive the choice probability for j, by integrating over the population  k   xk k (cid:4) (cid:7) demographic and income distributions P (T ) andP (I): (cid:2) (cid:3) (cid:4) (cid:5) P (choicej ) = exp (cid:4)  j +  I I ipj + (cid:6)
 l exp  l +  I I ipl + (cid:4) k  k T T ixk k  k j T T ixk l (cid:7) dP (T ) dP (I) (11) We explain next how we compute this integral and how we extract the parameters that capture the population preferences.
With the model in hand, now we discuss how we identify the unknown parameters  j,  I and  T .
We apply methods similar to those used in [6, 7] and [25].
In general, we estimated the parameters by searching the parameter space in an iterative manner, using the following steps:
 and  (0) = ( (0) ,  (0) T ) using
 j a random choice of values.
shares.
unexplained remaining error in  j and evaluate the generalized method of moments (GMM) objective function.
rameter values for   = ( I ,  T ) and go to Step 2, until minimizing the GMM objective function.
We describe the steps in more detail below.
j Calculating market share sj: To form the market equations (i.e., model predicted market share = observed market share), we need two things: the right-hand side sobs that can be observed from our transaction data, and the left-hand side sj, derived from Equation 11.
Unfortunately, the integral in Equation 11 is not analytic.
To approximate this integral, we proceed as follows: Given the demographic distribution, we  generate  a consumer randomly, with a known demographic and income and, therefore, known preferences.
Then, using the standard Logit model (Equation 6), we generate the choice of the product for this consumer.
For example, assume that we have the following joint demographic distribution of travel purpose and age group: (cid:10) Age   45 Age > 45 Business F amily



 (cid:11) .
In this case, we have a 40% probability of generating a  sample consumer  with family travel purpose and age above 45.
By repeating the process and obtaining NT samples of demographics T i and NI samples of income I i, we can compute an unbiased estimator of the Equation 11 integral:5 sj ( j| )   1


 NI(cid:8) NT(cid:8) Ii T i
 (cid:3) (cid:4) (cid:5) exp (cid:4)  j +  I I ipj + (cid:6) l exp  l +  I I ipl + (cid:4) T T ikxk k  k k  k j T T ikxk l (cid:7) .
(12) Estimate mean utility  j: Since we know how to compute market shares from the parameters, we can now  nd a value of  j that best  ts  the observed market shares.
(Notice that, conditional on   = ( I ,  T ), market share sj can be viewed as a function of the mean utility  j.)
We apply the contraction mapping method recommended by Berry [6], which suggests computing the value for   using an iterative approach:  (t+1) j =  (t) j + (ln(sobs j )   ln(sj( (t) j | ))).
(13) The procedure is guaranteed to converge [6] and  nd  j that satis es sj( j| ) = sobs .
j
 We use NT = NI = 100 in our study.
we have the market shares and the mean utility parameters, we need to  nd the most likely demographic-speci c weight deviations   = ( I ,  T ).
Of course, di erent values for   = ( I ,  T ) will lead to di erent mean utilities and market shares.
Hence, we need to  nd a criterion for identifying the best solution.
We perform this in two steps: First, we use Instrumental Variables (IV) [13] to estimate the mean weights   and  , and extract the unobserved error term   from the mean utility function:  ( ) =  ( )   (  k   xk       p).
(14) (cid:2) k In our study, we use the average price of the  same-star rating  hotels in other markets as the instrument for price of a particular hotel to ensure that we do not have a correlation of the error term with a variable in our regression.
Then, using the generalized method of moments,6 we base our analysis on the moment condition that the mean of the unobserved error term   is uncorrelated with the instrumental variable IV .
Thus, in our case we are trying to minimize the objection function: GM M obj( ) =E [ (cid:3) ( )   IV ].
(15) Iterate until GMM objective function is minimized: Once we identify the mean utility for a given set of weight deviations   = ( I ,  T ), we note the value of the GMM objective function GM M obj( ).
Then, we use the Nelder-Mead Simplex algorithm [21] to search for the optimal   T ) that minimizes the GMM objective function.7 This whole process eventually8 identi es the heterogeneous weights that di erent I I i, and those consumers assign to product price,  (I i) =   T   T i.
being assigned to product characteristics,  (T i) =   = (  +   I ,   +  conf 1+ F conf   1 +  B Example 4.
To illustrate this better, let s again look at Example 3, We know that, for business traveler, the utility surplus from hotel A1 (conference center, no pool) is U SB(A1) = pool   0) + , and for family travelers, the corre- A1 + ( B pool 0)+.
sponding utility surplus is U SF (A1) =  A1 +( F By  B  we denote the deviations from the population mean for business travelers towards  conference center  and  pool  and by  F  we denote the respective deviations for family travelers.
Similarly, we can write down the utilities for hotels A2, B1 and B2.
Following the estimation steps discussed above, we discover that family travelers have  F pool = 0.5.
In other words, they have the same preferences regarding a pool and conference center.
On the other hand, for business travelers, their preference towards  conference center  is much higher than towards  pool,  with  P pool = 0.1, respectively.
conf = 0.9 and  F conf =  F Next, we explain how we leverage the above knowledge for building a better ranking model for product search.
So far, we have described models for inferring the preferences of consumers using a utility model and aggregate demand data.
Due to space restrictions, we do not describe the GMM method in detail here.
We refer the interested reader to [12] for further explanations.
This approach is typically better than just following the function gradient.
See http://linux.math.tifr.res.in/programming-doc/gsl/gsl-ref_ 34.html for an open source implementation and details.
In our application, the computational time for each call (i.e., the inner loop) to the GMM objective function to solve for the mean utility is around 3 minutes on average.
The global parameter search (i.e., the outer loop) by minimizing the GMM objective function takes an average of 20 calls.
The total time for the estimation is around 40-60 minutes.
These models use the concept of surplus mainly as a conceptual tool to infer consumer preferences towards di erent product characteristics.
In our work, the concept of surplus is directly used to  nd the product that is the  best value for money  for a given consumer.
This simple idea is at the core of our work and as we will demonstrate in the experimental evaluation, it can lead to signi cant improvements in the quality of product search results.
Surplus-based Ranking: The  rst approach is to use the estimated surplus for each product and rank the available products in decreasing order of surplus.
Therefore, at the top we will have the products that are the  best value  for consumers, for a given price.
We de ne Consumer Surplus for consumer i from product j as the  normalized utility surplus,  the surplus  U S(i) j divided by the mean marginal utility of money  .
(cid:2) t CSj = N ormalized U Sj =  U S(i) j .
  (16) In the general, non-personalized case, if we were ranking products based on the  training  demand data then, in theory, our product ranking would be similar to a  best selling  ranking: The products that generate that largest surplus are the ones that would also generate the highest sales.
(Notice that rational consumers prefer the products that generate the highest surplus.)
However, when ranking products that are available today, the surplus-based ranking may be di erent for a variety of reasons: the product price may have changed, making some products a better  value for money,  we may have a new product in the market, or the value of some product features may be time-dependent (e.g., the value of being next to a lake may be positive during warm weather and negative during the winter).
Personalized Surplus-based Ranking: In Section 3.2 we described how to estimate the value that consumers place on di erent product features, based on their own demographics and purchase context.
The main outcome is that the value (surplus) that consumers get from a particular purchase is di erent than the average surplus for the overall population.
This means that even the best possible ranking for the general population may not be optimal for an individual consumer.
Therefore, we extend our ranking to include a personalization component.
To compute the personalized surplus, we can ask the consumer to give the appropriate demographic characteristics and purchase context (e.g., 35-49 years old, male, $100K income, business traveler) and then use the corresponding deviation matrices  T and  I .
It is then easy to compute the personalized  value for money  for this individual consumer, and rank products accordingly.
Notice that the consumer has the incentive to reveal demographics in this scenario.
Example 5.
For better understanding, let s reconsider the previous setting of the two hotels A1 and A2 for city A from Examples 3 and 4.
Suppose that two consumers are traveling to city A on the same day: C1, a 35-49 years old business traveler, with an income $50,000-100,000, and C2, a 25-34 years old family traveler, with an income less than $50,000.
Since these two travelers belong to di erent demographic groups and travel with di erent purposes, their preferences towards  conference center  and  pool  are di erent.
Thus, the surplus they obtain from A1 and A2 varies.
For example, the business traveler gets higher utility from A1 due to the specialized conference center services, whereas the family traveler  nd A2 more valuable due to the pool and price.
This personalization component allows each consumer to identify the product that is the  best value for the money.  For our experimental evaluation, we instantiated our model framework using as target application the area of hotel search.
Demand data: Travelocity, a large hotel booking system, provided us with the set of all hotel booking transactions, for
 transactions covered the period from November 2008 until January 2009.
Based on the given transactions, we were able to compute the market shares of each hotel in each local market (i.e., metropolitan area), for each day.
Consumer demographics data: To measure the demographics of consumers in each target market, we used data provided by TripAdvisor: The consumers that write reviews about hotels on TripAdvisor also identify their travel purpose (business, romance, family, friend, other ) and age group (13-
were able to identify the types of travelers for each destination.
To ensure the quality of the data, we computed the Jensen-Shannon divergence of the demographic distribution extracted from TripAdvisor with the corresponding traveler information from Travelocity, whenever available.
The distributions were very similar with an average divergence of just 0.03.
Hotel location characteristics: We used geo-mapping search tools (in particular the Bing Maps API) and social geo-tags (from geonames.org) to identify the  external amenities  (e.g., shops, bars, etc) and public transportation in the area around the hotel.
We also used image classi cation together with Mechanical Turk to examine whether there is a nearby beach, a nearby lake, a downtown area, and whether the hotel is close to a highway [16].
We extracted these characteristics within an area of 0.25-mile, 0.5 mile, 1-mile, and 2-mile radius.
Hotel service characteristics: We extracted the service characteristics from the reviews from TripAdvisor.
Each review provides a general rating of the hotel, plus provides seven individual ratings on the following service characteristics: Value, Room, Location, Cleanliness, Service, Check-in, and Business Service.
We used the average ratings of each hotel across these seven characteristics, together with the general review rating.10 We also used the hotel description information from Travelocity, Orbitz, and Expedia, to identify the  internal amenities  (e.g., pool, spa, etc.)
Stylistic characteristics of online reviews: Finally, we extracted indicators that measure not the polarity of the reviews but rather some stylistic characteristics of the available reviews.
We examined 2 text-style features:  subjectivity  and  readability  of reviews [10].
Also, since prior research suggested that disclosure of identity information is associated with changes in subsequent online product sales [9], we measured the percentage of reviewers for each hotel who reveal their real name or location information on their pro le web pages.
Figure 2 shows the histograms of the important continuous variables, together with their correlations and scatterplots that illustrate the joint distributions of the variable pairs.
In the previous section, we have discussed how we retrieved di erent hotel characteristics through various sources.
In this
 There are other demographics available as well, such as  gender,   traveler residence location, traveling with, usual travel style  and  usual travel purpose.  However, these  elds were relatively sparsely populated.
Therefore, we did not use these variables for our study.
We have also extracted service-related variables by mining directly the text of the reviews [2, 23] but the additional information did not improve our model in a statistically signi cant manner.
Variable Coef.
Variable Price Avg review length # of ext.
amenities Readability (SMOG) Spelling errors Avg.
Subjectivity Dev.
Subjectivity % of non-anon reviews Hotel Class Review Rating # of rooms Review Clean Review Checkin Lake 0.1157 # of competitors
 0.0013 # of int.
amenities
 -0.0764 -1.3468 Transport -2.9106 Highway
 0.0317 # of reviews


 -0.1151 Review Bus Service Coef.
-0.0930 -0.4226

 -0.1884


 -0.3897 -0.2988


 Table 1: Estimation results for mean weights (listing only statistically signi cant coe cients, with p <0 .05) section, we present our  ndings from the empirical estimation.
First, in Section 6.1 we present the results on estimating the model parameters, which correspond to the consumer preferences.
Then, in Section 6.2, we show that our models generate signi cantly better rankings than the existing baselines.
Interpretation of Estimated Weights We present only the estimation results for the BLP model, as the results are strongly superior and closer to reality compared to the results from the Logit model.
Results for general population: Table 1 shows the estimation results for the mean weights,   and  , for the di erent variables in our model that have a statistically signi cant e ect on demand.
From the results,  beach  presents the highest positive impact compared to the other location characteristics.
We also found signi cant impacts from service characteristics and quality characteristics of word-of-mouth.
Meanwhile,  price  presents a positive sign, which is consistent with the  law of demand  in reality and indicates that the higher the price, the lower the demand.
The negative sign on subjectivity means that customers are positive in uenced by reviews that describe factual characteristics of hotels, and do not want to read personal stories of reviewers.
(Notice that this is independent of the review polarity.)
Notable is the negative sign on the review value rating, which indicates that hotels that receive a  high value  rating have lower demand.
This is not surprising: these are the hotels that are  undiscovered  and therefore have lower demand and prices than otherwise expected.
Results for speci c demographics: We also obtained the demographic-speci c deviations from the mean.
We used purchase context and age group as the demographic dimensions for our experiments (see Section 5).
The value of demographic-speci c deviation shows the  sensitivity of evaluation  for a product characteristic, within a particular consumer type.
For example, customers on a romantic trip are more sensitive to hotel characteristics like  class  or  close to a beach , but they are less interested to know whether or not the hotel is close to highway exits.
On the contrary, customers on a business trip are more sensitive to hotel characteristics like  internal amenities  or  easy access to highway , whereas they are likely in uenced by the star rating of the hotel, compared to romance travelers.
Figure 3 shows in details the evaluation deviations among di erent types.
We also examined age-speci c preferences.
Again, we found strong evidence for the deviation of weights associated with di erent age groups.
Especially for  reviewer overall rating  and  review count , the deviations become quite striking.
Figure 4, shows that customers from age 18 to 34 tend to be more sensitive to online reviews, compared to older ages.
In particular, they room, location, checkin, service, business service, rooms, class, crime, int amenities, review count, cleaningness, tripadvisor rating).
Top: correlations of variable pairs.
Bottom: scatterplots with ellipses for joint distributions of variable pairs.
City TripAdvisor Travelocity Booked Low to High to Most Price Price

















 High





 Low





 New York Los Angeles San Francisco Orlando New Orleans Salt Lake City Signi cance Level Hotel Class





 # of # of Diversity: Reviews Rooms Amenities Price with # of

















 Class





 p = 0.05   56% p = 0 .01   59 % p = 0.001   61% (Sign Test
 Table 2: Consumer-surplus-based ranking vs. existing baselines.
The percentage shows the number of users than indicated preference for the ranking of our surplus-based ranking, compared to the corresponding baseline ranking.
The comparison was a pairwise blind comparison of rankings of 10 hotels.
Each cell corresponds to a separate test using N = 200 users, for a total of 12000 comparisons.
Across all comparisons, our ranking fares better in a statistically signi cant manner.
Given the noise inherent in the Mechanical Turk ratings (some users may give random answers in such tests and vote equally for both approaches), the results show a strong superiority of the surplus-based rankings.
are 10-15 times more sensitive to online reviews compared to the age demographic of  65+ year old. 
 With the estimated weights, we can derive the consumer surplus for each product (hotel), which can then be used to generate rankings.
In our experiments, we used six metropolitan areas for which we generated hotel rankings (we used big cities, so that we have a meaningful number of hotels to rank).
Rankings based on the average consumer surplus vs.
existing ranking baselines.
: We used 10 di erent, existing rankings as a baseline for comparison, and we compared each baseline against our own surplus-based ranking.
For each city and each ranking baseline, we performed pairwise blind tests, asking 200 anonymous users on Amazon Mechanical Turk11 to compare pairs of rankings and tell us which of the hotel ranking lists they prefer better.
In all 60 comparisons, each using 200
 We restricted participation to US-based users.
Mechanical Turk users are representative of the general US population.
users, the majority of users preferred our surplus-based rankings, in a statistically signi cant manner.
Given that some MTurk users may be giving us random results, we expect the  real  performance of our algorithm to be even better than indicated in the numbers in Table 2.
Qualitative analysis: We also asked consumers why they chose a particular ranking, to better understand how users interpret the surplus-based ranking.
Many users that liked our ranking indicated that our ranking promotes the idea that price is not the only main factor in rating the quality of products.
Moreover, users strongly preferred the diversity provided by our ranking across both price and quality.
In contrast, the other ranking approaches tend to list products of only one type (e.g., hotels with high review ratings are often very expensive hotels and the  most booked  are often 3-star mediocre hotels).
We should emphasize at this point that our algorithm does not try explicitly to introduce diversity in the results.
This is a direct outcome of our economic-based approach: If a segment of the market is systematically underpriced (hence making the  best deals  a homogeneous list), then we expect the market forces to  x this




























































































 Figure 3: Sensitivity towards di erent hotel characteristics for Romance, Business, Family, and Friends-getaway travelers.
We present absolute values, without polarity, to illustrate sensitivity on di erent product characteristics.
Personalized rankings vs. rankings using average consumer surplus: We generated a few personalized rankings for di erent cities based on consumer-speci c attributes, such as travel purpose.
We conducted blind comparisons in a pairwise fashion, based on 200 anonymous AMT users, for each comparison.
Since we did not know the demographics of the users, we asked the MTurk workers to  select the hotel ranking you would prefer to use while trying to help a business traveler to book a hotel in New York  12.
Based on the user responses, customers strongly preferred the personalized ranking that was tailored for a particular travel purpose using our technique (p = 0.01, sign test).
For example, in our NYC experiment, 77% customers indicated their preferences towards the business-oriented ranking (ranking tailored for business travelers) rather than the average-level ranking, and 81% customers did so towards the family-oriented ranking (ranking tailored for family trip travelers).
The results were similar across all tests.
Qualitative analysis: When we asked users  opinions for these comparisons, users did not bring up the issue of diversity.
This was expected, as even our non-personalized rankings were already diverse.
Instead, we found customers considering the context and expectations for a given trip.
For example, users indicated that hotels for business trips do not necessarily need to be luxury, but need to provide a quiet business environment and easy access to highway or public transportation.
On the other hand, for romantic trips, users strongly preferred the recommendations for luxury services with higher class rating.
These results highly dovetail with our empirical estimation, suggesting that our ranking model indeed captures consumers  real purchase motivation behind the scene.
Our research is related to the work in online recommender systems, in particular, the content-based systems that recommend items similar to those that a user liked in the past (e.g., [20]).
Content-based systems learn user preferences from the individual-level pro les elicited from users explicitly (e.g., through questionnaires or identi ed transactional behaviors).
To compute a  content-based weight vector , a variety of techniques were used, such as the Rocchio algorithm, Bayesian classi ers, and Winnow algorithm [1].
Our research also leverages work on
 Of course, we substituted  business traveler  and  New York  with the appropriate values for each comparison.
Figure 4: Sensitivity of di erent age groups to review rating & review count: Ages groups 18-24 and 25-34 pay more attention to online reviews compared to other age groups.
City Business Romance Family Friends New York Los Angeles
 Orlando















 Table 3: Personalized surplus-based rankings vs. non-personalized, surplus-based rankings.
The percentage shows the number of users than indicated preference for the personalized ranking compared to the general, non-personalized surplus-based ranking.
Each cell of the table corresponds to N = 200 users, for a total of 3200 comparisons.
In all cases, the personalized approach is better at the p = 0.1% level (sign test).
irregularity by increasing demand (and hence prices) for these products.
To test if we can generate same satisfaction levels by introducing diversity arti cially, we also generated an additional  diversity ranking  using combined criteria of  price  and  hotel class.  We interlaced the top-5 hotels with  the lowest price  and the top-5 hotels with  the highest ratings.  The comparison of this  diversity-enabled  ranking against our algorithm also indicated that surplus-based diversity is better than an arti cially-introduced diversity metric: In all cases, users strongly preferred the surplus-based ranking, as shown in the last column of Table 2.
[1] Adomavicius, G., and Tuzhilin, A.
Toward the next generation of recommender systems: A survey of the state-of-the-art and possible extensions.
IEEE TKDE 17 (2005), 734 749.
[2] Archak, N., Ghose, A., and Ipeirotis, P. G. Show me the money!
: deriving the pricing power of product features by mining consumer reviews.
In KDD (2007), pp.
56 65.
[3] Balke, W.-T., and G untzer, U. Multi-objective query processing for database systems.
In Proceedings of 28th International Conference on Very Large Data Bases (VLDB) (2004), pp.
936 947.
[4] Bao, S., Wu, X., Fei, B., Xue, G., Su, Z., and Yu, Y. Optimizing web search using social annotations.
In WWW (2007).
[5] Berry, S. Estimating discrete choice models of product di erentia-tion.
RAND Journal of Economics 25 (1994), 242 262.
[6] Berry, S., Levinsohn, J., and Pakes, A.
Automobile prices in market equilibrium.
Econometrica 63 (1995), 841 890.
[7] Berry, S., and Pakes, A.
The pure characteristics demand model.
International Economic Review 48 (2007), 1193 1225.
[8] Chevalier, J.
A., and Goolsbee, A.
Measuring prices and price competition online: Amazon.com and BarnesandNoble.com.
Quantitative Marketing and Economics 1, 2 (2003), 203 222.
[9] Forman, C., Ghose, A., and Wiesenfeld, B.
Examining the relationship between reviews and sales: the role of reviewer identity disclosure in electronic markets.
ISR 19, 3 (2008), 291 313.
[10] Ghose, A., , and Ipeirotis, P. G. Estimating the helpfulness and economic impact of product reviews: Mining text and reviewer characteristics.
IEEE TKDE (2010).
[11] Ghose, A., Ipeirotis, P., and Sundararajan, A.
Opinion mining using econometrics: A case study on reputation systems.
In ACL (2007).
[12] Hansen, L. Large sample properties of generalized method of moments estimators.
Econometrica 50, 4 (1982), 1029 1054.
[13] Heckman, J.
Instrumental variables: A study of implicit behavioral assumptions used in making program evaluations.
Journal of Human Resources 32, 3 (1997), 441 462.
[14] Jin, R., Valizadegan, H., and Li, H. Ranking re nement and its application to information retrieval.
In WWW (2008).
[15] Lancaster, K. Consumer Demand: A New Approach.
Columbia University Press, New York, 1971.
[16] Li, B., Ghose, A., and Ipeirotis, P. G. Stay elsewhere?
improving local search for hotels using econometric modeling and image classi cation.
In WebDB (2008).
[17] Marshall, A.
Principles of Economics, Eighth ed.
Macmillan and Co., London, 1926.
[18] McFadden, D. Conditional Logit Analysis of Qualitative Choice Behavior.
Academic Press, New York, 1974.
[19] McFadden, D., and Train, K. Mixed MNL models of discrete response.
Journal of Applied Econometrics 15, 5 (2000), 447 470.
[20] Mooney, R., and Roy, L. Content-based book recommending using learning for text categorization.
In ACM SIGIR Workshop Recom-mender Systems: Algorithms and Evaluation (1999).
[21] Nelder, J.
A., and Mead, R. A simplex method for function minimization.
The Computer Journal 7, 4 (1965).
[22] Nie, Z., Wen, J.-R., and Ma, W.-Y.
Webpage understanding: beyond page-level search.
SIGMOD Record 37, 4 (2008), 48 54.
[23] Pang, B., and Lee, L. Opinion mining and sentiment analysis.
Foundations and Trends in Information Retrieval 2, 1-2 (2008).
[24] Rosen, S. Hedonic prices and implicit markets: Product di erentia-tion in pure competition.
J. of Political Econ.
82, 1 (1974), 34 55.
[25] Song, M. A hybrid discrete choice model of di erentiated product demand with an application to personal computers.
FR 08-09, 2008.
[26] Ye, Q., Law, R., and Gu, B.
The impact of online user reviews on hotel room sales.
Int.
J. of Hosp.
Mgmnt.
28, 1 (2009), 180 182.
[27] Yee, K.-P., Swearingen, K., Li, K., and Hearst, M. Faceted meta-data for image search and browsing.
In CHI (2003), pp.
401 408.
learning consumer opinions from online reviews [23, 26].
In our work, through user modeling, we identify how users behave as a response to online reviews [2], and demonstrate how to extract demographic-speci c preferences.
Other studies proposed to combine popularity with user feedback or social annotations to re ne search results [4, 14].
We presented a ranking algorithm that uses a behavioral model of consumers, based on utility maximization.
The model generates an estimate of how much each product characteristic contributes to the product s overall utility, and estimates the sensitivity of consumers to changes in various product characteristics.
The estimation models are privacy-friendly as they do not require individual consumer data but rather rely on aggregate data.
Based on the generated models, we can estimate the surplus that each product generates for each consumer, and build rankings that capture the user preferences.
We demonstrated, through extensive user studies, that our ranking schemes are better than any of the existing baselines.
We also showed that personalized surplus-based rankings are even better than the non-personalized surplus-based rankings.
By doing so, we are able to target at each individual customer, and o er products with the  best value for money  in response to consumer queries.
We should also note that our ranking scheme is  causal,  in the sense that the model can predict what  should  happen when we observe changes in the market.
For example, when we see a new product in the marketplace, we can rank it by simply observing its characteristics, without waiting to see the consumers  demand for the product.
Also, we can dynamically change the rankings as a reaction to changes in the products.
For example, if we observe a price change, or if we observe that a hotel closes its pool for renovations, we can adjust immediately the surplus values and re-estimate the rankings.
Also, in order to better understand the antecedents of consumer s decisions, future work can look not only at transaction data but also into their browsing history and learning behavior.
For example, our current model assumes that consumers are engaging into optimal utility maximizing behavior.
However, this is not always true, as some consumers are more thorough than others in their search.
By leveraging browsing histories, we can build models that explicitly take into consideration the fact that some users are  utility optimizers  and some others simply engage into  satis cing.  It would be also interested in examining the di erence in the conversion rate of users, when presented with surplus-based rankings.
By examining product search through the  economic lens  of consumer behavior, we can leverage micro-economic theory and many theoretical models that have been developed over the years, which try to capture the decision-making process of humans.
Economic theory provides a very solid basis upon which we can build further computer science research, which has a di erent focus than economic research.
Our example is illustrating: while economists have been building utility models for years, their goal was to estimate demand for products and the notion of surplus was just  a means to an end  and never had of value by itself.
By focusing on product ranking, we showed how surplus can improve product search.
Our experimental results demonstrated a signi cant improvement in user satisfaction.
Other economic models (e.g., measuring the utility of product bundles) can also be directly used in consumer-facing applications on the Web (e.g., search for  product bundles  instead of simple products).
We are very optimistic that this interdisciplinary research direction can generate very interesting results in the future.
