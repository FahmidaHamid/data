
The result in the previous section says that the problem
of choosing the optimal set of advertisers cannot even be
approximated well, in the most general case. However, as we
will show in this section, the problem can be solved exactly
in certain special cases.
5.1 Single-peaked preferences

Single-peaked preferences form an important domain of
preferences, and are well-studied in the contexts of majority
voting and Arrovian social welfare functions, strategyproof
voting rules, and fair division, among others (see, for exam-
ple, [3, 13]).

165WWW 2008 / Refereed Track: Internet Monetization - Online AdvertisingApril 21-25, 2008 · Beijing, ChinaWe start by deﬁning the notion of single-peaked prefer-
ences in the context of the externality problem. Recall that
the preference of each user type j is given as a permuta-
tion πj of {0, 1, . . . , n}, where 0 is the outside option and
1, . . . , n represent advertisers. We say that the user prefer-
ences are single-peaked (with respect to the ordering 1, . . . , n
of the advertisers), if for every user type j, there is a value
aj ∈ {1, . . . , n}, such that for every 1 ≤ x < y ≤ aj, adver-
tiser y is preferred to advertiser x according to πj, and for
every aj ≤ x < y ≤ n, advertiser x is preferred to advertiser
y according to πj. In other words, each user type j has an
ideal advertiser aj, and advertisers before aj are ranked ac-
cording to their distance to aj, and similarly for advertisers
after aj. No restriction is placed on how j ranks two adver-
tisers, one before aj and the other after aj, or how she ranks
any advertiser in comparison to the outside option.

The following theorem gives an algorithm for the winner
determination problem with externalities, when preferences
are single-peaked, with respect to a known ordering 1, . . . , n.

Theorem 5. The winner determination problem with ex-
ternalities can be solved in polynomial time if user prefer-
ences are single-peaked.

Proof. We give a dynamic programming algorithm for
this problem. The main step is to deﬁne an appropriate sub-
problem, which can be solved recursively. The subproblem
we use is parameterized by two parameters i and r, with
1 ≤ i ≤ n and 1 ≤ r ≤ k, and is deﬁned as follows:

Consider an instance of the winner determination
problem with externalities where the set of user
types is restricted to {j : aj ≥ i} (note that we
do not change the probabilities pj’s, so in this
restriction the probabilities can add up to less
than 1. However, the problem is still well-deﬁned
in this case). Let SOLi,r be the maximum value
v(S) of a set S satisfying the following: i ∈ S,
S ⊆ {i, . . . , n}, and |S| ≤ r.

We show how SOLi,r can be computed recursively. The
idea is to focus on the ﬁrst advertiser after i that will be
included in the set S. If i0 is the index of this advertiser,
the value derived from user types j with aj ≥ i0 can be
written as SOLi0,r−1, since by the single-peaked property of
the preferences, none of these users prefers any advertiser
before i0 to i0. Users j with i ≤ aj < i0 will choose one of
the advertisers i and i0 or the outside option (again, by the
single-peaked property). Therefore, the total value of the
solution in this case can be written as

X

X

SOLi0,r−1 +

pjvi +

pjvi0 ,

j∈Si,i0

j∈Si0,i

where Si,i0 := {j : min(i, i0) ≤ aj < max(i, i0) and πj(i) <
min(πj(i0), πj(0))} is the set of users whose ideal advertiser
is between i and i0 and prefer i to i0 and also to the outside
option. To compute SOLi,r, we need to take the maxi-
mum over all i0 of the above expression, and also of the case
where there is no such i0, i.e., i is the last advertiser that is
included in the set. In this case, the value of the subproblem
pjvi, where Si,n+1 := {j : aj ≥ i and πj(i) <
πj(0)} is the set of users whose ideal advertiser is after i and
who prefer i to the outside option. To summarize, SOLi,r

is P

j∈Si,n+1

8<: X

j∈S0,i

9=; ,

can be computed using the following recursive formula for
every r ≥ 2.

SOLi,r = max{ X
X
For r = 1, we have SOLi,r = P

j∈Si,n+1

j∈Si,i0

pjvi +

+

{SOLi0,r−1

pjvi, max
i0>i

X

j∈Si0,i

pjvi0}}.

(4)

(5)

pjvi. Using the
above recursions, one can compute all the SOLi,r’s in time
O(n2km). Using the above argument, it is easy to see that
the solution of the problem can be computed in terms of
these values as follows:

j∈Si,n+1

max

i=1,...,n

pjvi + SOLi,r

where S0,i = {j : aj < i and πj(i) < πj(0)} is the set of
users whose ideal advertiser is before i and who prefer i to
the outside option. This gives an O(n2km)-time algorithm
to solve the winner determination problem with externalities
when user preferences are single-peaked.

Remark 1. Note that the size of the dynamic program-
ming table in the above algorithm is O(nk), which is inde-
pendent of the number of diﬀerent user types. Therefore,
our algorithm can be adapted to the cases where there are
exponentially many user types, and they are given either by
an oracle, or with an implicit representation. The only in-
gredient needed is an algorithm that computes summations
like the ones in Equation (4).
5.2 Perturbed single ranking

We now consider another special case of the winner de-
termination problem, where user preferences are given im-
plicitly using the following distribution of advertiser qual-
ities: Advertiser i has quality qi = xi with probability pi
(where xi’s are a given distinct values), and −1 with prob-
ability 1 − pi; the quality is independent of all other ad-
vertisers’ qualities. The quality parameter for the outside
option is ﬁxed at q0 = 0. This gives rise to exponentially
many permutations which are all subsets of a single underly-
ing permutation deﬁned by the xi’s, but each advertiser i is
dropped from the permutation (independently) with proba-
bility 1 − pi.

An interpretation of this model is that there is an under-
lying true quality rating amongst all advertisers (as given by
the ordering of the xi’s), and a user who is informed about
two advertisers i and j ranks them in this order. However,
with probability 1 − pi, the user has not heard of advertiser
i, in which case she will not choose this advertiser. In other
words, users rank the advertisers according to independent
perturbations of the same ranking, under a particular model
of perturbation. As we will point out in Remark 2, the idea
can be generalized to more general “local” perturbation mod-
els.

The value of a set of advertisers S in this model can be

written as

v(S) =

X

i∈S

Y

vipi

j∈S,xj >xi

(1 − pj).

(6)

Theorem 6. The winner determination problem in the

above model can be solved exactly in polynomial time.

166WWW 2008 / Refereed Track: Internet Monetization - Online AdvertisingApril 21-25, 2008 · Beijing, ChinaProof. Again, we use dynamic programming to give a
Θ(nk)-time algorithm for the winner determination prob-
lem.
Number advertisers in decreasing order of xi, so that x1 >
x2 > ··· > xn. We consider the following subproblem: Let
SOLi,r denote the optimal value when no more than r adver-
tisers can be selected from the subset i, . . . , n of advertisers.
In other words, SOLi,r := maxS⊆{i,...,n},|S|≤r{v(S)}.
Note that v(S ∪{i}) for i < min(S) is pivi + (1− pi)v(S).

Using this, it is easy to prove the following recursion.

SOLi,r = max(SOLi+1,r, vipi + (1 − pi)SOLi+1,r−1).

Starting from i = n (SOLn,r = pnvn for all r), we popu-
late a table with nk entries; computing each entry in the
table takes Θ(1) time. Therefore, the solution of the winner
determination problem, which is given by SOL1,k, can be
computed in time O(nk).

Remark 2. Note that the only thing our algorithm re-
lies on is that if i is before all elements of S, v(S ∪ {i})
can be computed from v(S). For many other models of per-
turbation that perturb the permutation locally and indepen-
dently, a similar approach works, perhaps by keeping a lim-
ited amount of information about the set S. As an example,
consider perturbations of the following form: swap the order
of the advertisers 2i − 1 and 2i in the underlying permuta-
tion with probability p0
i, independently for all i; then from
the resulting permutation, drop element j with probability
pj, independently for all j. If i is before all elements of S,
v(S ∪ {i}) can be computed given v(S) and the lowest-index
element of S. Therefore, the winner determination prob-
lem can be solved in this perturbation model by a dynamic
programming algorithm with an n × n × k table.

6. ALTERNATIVE MODELS

In this section we discuss two other models that are not
based on a model of users’ choices, but are simpler and there-
fore might be more applicable in practice.

Pairwise multiplicative model. As before, there are n
advertisers with private values v1, . . . , vn. The model is de-
ﬁned in terms of parameters aij ∈ [0, 1] for 1 ≤ i, j ≤ n. The
value of aij represents the factor by which advertiser j de-
creases the value to advertiser i, if both are chosen together
in the winning set. The value of a set S is

Y

X

i∈S

v(S) =

vi
j∈S\{i}

aij.

In terms of the computational complexity of the winner de-
termination problem, this problem is still hard to approxi-
mate, since by taking aij ∈ {0, 1}, one can see easily that the
independent set problem is a special case of this problem.

This model assumes that
Uniform discount model.
diﬀerent advertisers experience the same degree of discount,
which depends only on total weight of the set of winners.
More precisely, we assume each advertiser i has a private
value vi and a weight wi (the weight could correspond to
the conversion rate or another measure of the importance of
the advertiser), and we are given a non-increasing function
f : R 7→ [0, 1], which speciﬁes the discount as a function of
the total weight of the advertisers in the set. The value of a

set S is given by

X

i∈S

v(S) =

X

j∈S

vif (

wj).

It is not hard to see that the winner determination problem
in this model can be solved using the algorithm for the knap-
sack problem: for every level W of the total weight, we can
compute the set SW of advertisers of maximum total value
whose weight add up to at most W . This can be computed
using a knapsack algorithm. The solution of the winner de-
termination problem is the maximum, over all choices of
W , of the value of SW . With an appropriate discretization
of values of W , this can be made into a polynomial time
approximation scheme for the problem. When weights are
small integers, this approach gives a polynomial time ex-
act algorithm for the problem. Turning the approximation
scheme for the winner determination problem into a truth-
ful mechanism remains an open question. One approach to
tackle this problem would be to use the techniques developed
in the context of multi-unit auctions [10].

7. DISCUSSION

In this paper, we discussed models for the externality
problem in online advertising. We proved that for the most
general model, the winner determination problem is com-
putationally hard, and gave algorithms for this problem in
some special cases.

We believe that the externality problem is a major issue
in the study of online advertising, and so far has not re-
ceived enough attention from the research community.
In
the following, we list a few directions for future research.

Location-dependent externalities.
The models stud-
ied in this paper, motivated by the lead generation busi-
ness, was developed for a setting where the only decision
made by the winner determination algorithm is the set of
advertisers who get an advertising opportunity (by receiv-
ing a lead), without any particular order. However, in the
cases where the auction decides which advertisements should
be displayed on a page (which is the more common case),
the winner determination algorithm should not only specify
which ads are displayed, but also in which slot each ad is
displayed. Furthermore, in this setting the externalities can
be location dependent: for example, a sponsored search ad
displayed in the 10th slot might impose no externality on
the ad displayed on the top slot. Therefore, in order to be
applicable to this setting, our model for externalities has to
be modiﬁed to take the locations into account.

A simple way to incorporate the location component into
our model is as follows: assume the slots are numbered
1, 2, . . . , K, from top to bottom. We assume a random user
only looks at the ads in the top X slots, where X is a random
variable with a given distribution. The user then decides
which of the ads she has looked at to click on, according to
one of our models.

Clearly, our hardness result for the winner determination
problem works for this more general model as well. It would
be interesting to ﬁnd interesting special cases of this problem
that can be solved in polynomial time.

The long-term externality eﬀect.
In this paper,
our focus was on the immediate externality that advertisers
impose on each other, in terms of lowering the conversion
rate or the click-through rate of other advertisers in the same

167WWW 2008 / Refereed Track: Internet Monetization - Online AdvertisingApril 21-25, 2008 · Beijing, Chinasession. There is also a long-term externality eﬀect: if a user
ﬁnds the ads displayed on a website (e.g., sponsored search
ads on Google) helpful, he or she is more likely to click on ads
in the future, and conversely, if the ads are found to be not
relevant, the user will pay less attention to ads in the future.
This externality eﬀect is well understood in the context of
traditional advertising, and is sometimes referred to as the
rotten-apple theory of advertising [4]. The implication of
this eﬀect in the context of traditional advertising media is
in the domain of public policy: it is used to justify adopting
regulations against false advertising.

In the context of online advertising, however, there is
much more a publisher can do to measure this type of ex-
ternality and reward or punish advertisers based on whether
they create positive or negative externality. Publishers such
as Google or Yahoo often can track when a user revisits their
website and clicks on an ad, and also whether an ad leads
to a conversion or some action on the advertiser’s site. De-
signing mechanisms to extract the relevant information from
this wealth of data and use it to overcome the externality
problem and maximize the eﬃciency of the system in the
long run is an interesting research direction.

Learning externalities.
Throughout this paper, we
studied the winner determination problem with externali-
ties, assuming that the parameters of the model – user pref-
erences in our main model – are known to the algorithm.
Learning these parameters given the history of choices made
by the users, or designing experiments in order to learn these
parameters remains open.

Diversity problem.
It is known that having diversity
among the set of web search results or among the set of
products displayed on an electronic store front is valuable.
There has been some eﬀort on designing algorithms in these
applications that give some weight to the diversity of the
solution set (see, for example, [16]). However, it is not clear
what is the right way to incorporate the diversity compo-
nent in the objective. Note that in our model, optimizing
for the value of solution in presence of externalities can au-
tomatically result in a diverse solution set. This is because
advertisers that are similar to each other impose greater
negative externality on each other (e.g., presumably an ad-
vertiser who sells Apple computers imposes little externality
on one that sells the fruit). This suggests that our frame-
work might be a good starting point for deﬁning a diversity
optimization problem that is based on economic principles.

Dating problem.
As mentioned earlier, online dating
services can also be considered in the framework of lead
generation. Similar externalities exist in the online dat-
ing industry: sending a woman w on a date with a man
m imposes a negative externality on all other men, since
it decreases their chances with w. Currently, online dating
services take one of the two extremes of either allowing un-
restricted search (i.e., a subscriber has access to the proﬁles
of anyone who meets his or her criteria, and can contact
them, which is the model adapted by Yahoo! Personals or
match.com), or matching people one pair at a time (this is
the model adapted by eHarmony). Chen et al. [2] initiated
the study of the eHarmony model from a stochastic opti-
mization point of view. An interesting direction for future
research is to study this problem in a model with external-
ities in order to strike the right balance between these two
extremes.

8. REFERENCES
[1] Aaron Archer and Eva Tardos. Truthful mechanisms

for one-parameter agents. In IEEE Symposium on
Foundations of Computer Science, pages 482–491,
2001.

[2] Ning Chen, Nicole Immorlica, Anna Karlin,

Mohammad Mahdian, and Atri Rudra. Approximating
matches made in heaven. in preparation, 2008.

[3] W. Gaertner. Domain restrictions. In K.J. Arrow,
A.K. Sen, and K. Suzumura, editors, Handbook of
Social Choice and Welfare, volume I, chapter 3, pages
131–170. Elsevier Science, 2002.

[4] Z. K. Hansen and M. Law. The political economy of
truth-in-advertising regulation in the progressive era.
Forthcoming at the Journal of Law and Economics.
An earlier version is available as NBER Working
Paper No. 11927, 2006.

[5] Philippe Jehiel and Benny Moldovanu. Strategic

non-participation. Rand Journal of Economics,
27(1):84–98, 1996.

[6] Philippe Jehiel and Benny Moldovanu. Eﬃcient design

with interdependent valuations. Econometrica,
69(5):1237–59, 2001.

[7] Philippe Jehiel, Benny Moldovanu, and E. Stacchetti.

How (not) to sell nuclear weapons. American
Economic Review, 86(4):814–829, 1996.

[8] Philippe Jehiel, Benny Moldovanu, and E. Stacchetti.
Multidimensional mechanism design for auctions with
externalities. Journal of Economic Theory,
85(2):258–294, 1999.

[9] T. Joachims, L. Granka, Bing Pan, H. Hembrooke,

F. Radlinski, and G. Gay. Evaluating the accuracy of
implicit feedback from clicks and query reformulations
in web search. ACM Transactions on Information
Systems (TOIS), 25(2), April 2007.

[10] Anshul Kothari, David C. Parkes, and Subhash Suri.
Approximately-strategyproof and tractable multiunit
auctions. Decision Support Systems, 39(1):105–121,
2005.

[11] Internet Advertising Bureau. Online lead generation:

Standards and guidelines.
http://www.iab.net/standards/lead_generation.asp.

[12] PricewaterhouseCoopers. IAB Internet Advertising

Revenue Report, 2006 Full-Year Results. available at
http://www.iab.net/resources/adrevenue/pdf/
IAB_PwC_2006_Final.pdf, May 2007.

[13] Y. Sprumont. The division problem with single-peaked

preferences: a characterization of the uniform
allocation rule. Econometrica, 59(2):509–519, 1991.

[14] J. H˚astad. Clique is hard to approximate within n1−.

Acta Mathematica, 182:105–142, 1999.

[15] Vijay V. Vazirani. Approximation Algorithms.

Springer-Verlag, 2001.

[16] Xiaojin Zhu, Andrew Goldberg, Jurgen Van Gael, and

David Andrzejewski. Improving diversity in ranking
using absorbing random walks. In Human Language
Technologies: The Annual Conference of the North
American Chapter of the Association for
Computational Linguistics (NAACL-HLT), 2007.

168WWW 2008 / Refereed Track: Internet Monetization - Online AdvertisingApril 21-25, 2008 · Beijing, China
